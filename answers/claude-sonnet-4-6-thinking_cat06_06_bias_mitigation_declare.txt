## Updated DECLARE Model with Bias-Mitigating Constraints

```python
declare_model = {
    # ------------------------------------------------------------------ #
    #  UNARY CONSTRAINTS                                                   #
    # ------------------------------------------------------------------ #
    "existence": {
        # --- Original ---
        "StartApplication":     {"support": 1.0, "confidence": 1.0},
        "FinalDecision":        {"support": 1.0, "confidence": 1.0},
        # --- NEW: fairness activities that must appear in every trace ---
        "BiasMitigationCheck":  {"support": 1.0, "confidence": 1.0},
        "ManualReview":         {"support": 1.0, "confidence": 1.0}
    },

    "absence": {},

    "exactly_one": {},

    "init": {
        "StartApplication": {"support": 1.0, "confidence": 1.0}
    },

    # ------------------------------------------------------------------ #
    #  BINARY CONSTRAINTS                                                  #
    # ------------------------------------------------------------------ #
    "responded_existence": {},

    "coexistence": {
        # --- Original ---
        "StartApplication": {
            "FinalDecision": {"support": 1.0, "confidence": 1.0}
        },
        # --- NEW: whenever a sensitive-attribute activity occurs,
        #         a ManualReview MUST also occur (and vice-versa) ---
        "CheckApplicantRace": {
            "ManualReview": {"support": 1.0, "confidence": 1.0}
        },
        "CheckApplicantAge": {
            "ManualReview": {"support": 1.0, "confidence": 1.0}
        },
        "CheckApplicantGender": {
            "ManualReview": {"support": 1.0, "confidence": 1.0}
        },
        # --- NEW: minority-specific decision steps always require
        #         a paired ManualReview ---
        "Approve_Minority": {
            "ManualReview": {"support": 1.0, "confidence": 1.0}
        },
        "Reject_Minority": {
            "ManualReview": {"support": 1.0, "confidence": 1.0}
        }
    },

    "response": {
        # --- Original ---
        "StartApplication": {
            "RequestAdditionalInfo": {"support": 1.0, "confidence": 1.0}
        },
        # --- NEW: after any sensitive-attribute disclosure, the process
        #         MUST eventually perform a BiasMitigationCheck ---
        "CheckApplicantRace": {
            "BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}
        },
        "CheckApplicantAge": {
            "BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}
        },
        "CheckApplicantGender": {
            "BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}
        }
    },

    "precedence": {
        # --- NEW: BiasMitigationCheck must happen BEFORE FinalDecision ---
        "BiasMitigationCheck": {
            "FinalDecision": {"support": 1.0, "confidence": 1.0}
        },
        # --- NEW: ManualReview must happen BEFORE FinalDecision ---
        "ManualReview": {
            "FinalDecision": {"support": 1.0, "confidence": 1.0}
        }
    },

    "succession": {
        # --- Original ---
        "RequestAdditionalInfo": {
            "FinalDecision": {"support": 1.0, "confidence": 1.0}
        }
    },

    "altresponse":    {},
    "altprecedence":  {},
    "altsuccession":  {},
    "chainresponse":  {},
    "chainprecedence":{},
    "chainsuccession":{},
    "noncoexistence": {},

    "nonsuccession": {
        # --- NEW: sensitive-attribute checks must NOT be followed
        #         (at any later point) by an unchecked Reject decision ---
        "CheckApplicantRace": {
            "Reject": {"support": 1.0, "confidence": 1.0}
        },
        "CheckApplicantAge": {
            "Reject": {"support": 1.0, "confidence": 1.0}
        },
        "CheckApplicantGender": {
            "Reject": {"support": 1.0, "confidence": 1.0}
        }
    },

    "nonchainsuccession": {
        # --- NEW: sensitive-attribute checks must NOT immediately precede
        #         a FinalDecision (at least one activity must intervene) ---
        "CheckApplicantRace": {
            "FinalDecision": {"support": 1.0, "confidence": 1.0}
        },
        "CheckApplicantAge": {
            "FinalDecision": {"support": 1.0, "confidence": 1.0}
        },
        "CheckApplicantGender": {
            "FinalDecision": {"support": 1.0, "confidence": 1.0}
        }
    }
}
```

---

## Rationale for Each Added Constraint

### 1. `existence` — `BiasMitigationCheck` and `ManualReview`

| Constraint | Meaning |
|---|---|
| `existence(BiasMitigationCheck)` | Every single trace must contain a bias-mitigation step. |
| `existence(ManualReview)` | Every trace must contain a human-in-the-loop review. |

**Why it reduces bias:** Guarantees that no loan application can be fully processed through an automated pipeline alone. Both a structured fairness audit (`BiasMitigationCheck`) and a human review (`ManualReview`) are mandatory in every case, ensuring consistent scrutiny regardless of which applicant attributes are disclosed.

---

### 2. `coexistence` — Sensitive Attribute Activities  `ManualReview`

```
CheckApplicantRace    ManualReview
CheckApplicantAge     ManualReview
CheckApplicantGender  ManualReview
Approve_Minority      ManualReview
Reject_Minority       ManualReview
```

**Why it reduces bias:** Coexistence is a symmetric obligation — if a sensitive attribute is checked, `ManualReview` must occur, and if `ManualReview` occurs, the sensitive attribute was checked. This enforces that whenever the process "sees" race, age, or gender, a human reviewer is always part of the trace. The `Approve_Minority`/`Reject_Minority` variants extend this to named decision outcomes, preventing minority applicants from being approved or rejected without a corresponding manual review anywhere in their process history.

---

### 3. `response` — `CheckApplicant*`  `BiasMitigationCheck`

```
CheckApplicantRace    BiasMitigationCheck
CheckApplicantAge     BiasMitigationCheck
CheckApplicantGender  BiasMitigationCheck
```

**Why it reduces bias:** A *response* constraint is forward-looking: once a sensitive attribute is disclosed, the process is *obligated* to eventually perform a `BiasMitigationCheck`. The decision pathway cannot simply bypass the check — the constraint is violated if the attribute is disclosed but the check never follows.

---

### 4. `precedence` — `BiasMitigationCheck` / `ManualReview` before `FinalDecision`

```
BiasMitigationCheck must precede FinalDecision
ManualReview        must precede FinalDecision
```

**Why it reduces bias:** A *precedence* constraint is backward-looking: `FinalDecision` is only valid if both `BiasMitigationCheck` *and* `ManualReview` have already occurred earlier in the trace. Together with the `response` constraint above, this creates a mandatory "fairness sandwich":

```
CheckApplicantRace  …  BiasMitigationCheck  …  ManualReview  …  FinalDecision
```

No final decision can be reached without both fairness gates having been passed.

---

### 5. `nonsuccession` — `CheckApplicant*`  `Reject`

```
CheckApplicantRace    Reject  (Reject cannot occur after CheckApplicantRace)
CheckApplicantAge     Reject
CheckApplicantGender  Reject
```

**Why it reduces bias:** The *non-succession* constraint forbids the pattern "disclosed a sensitive attribute  reject the applicant" anywhere in the trace. This directly blocks a discriminatory workflow where a reject outcome is causally chained to a race/age/gender disclosure. Approval or rejection can still happen, but only after the mandatory fairness checks (enforced by the `response` + `precedence` constraints) have broken the direct causal link.

---

### 6. `nonchainsuccession` — `CheckApplicant*`  (immediate) `FinalDecision`

```
CheckApplicantRace    FinalDecision  (must NOT be adjacent)
CheckApplicantAge     FinalDecision
CheckApplicantGender  FinalDecision
```

**Why it reduces bias:** The *non-chain-succession* constraint prevents `FinalDecision` from being the very next event after a sensitive-attribute check. Even if the overall ordering would be allowed, there must be at least one intervening activity between disclosing the attribute and issuing the final decision. In practice, this ensures that `BiasMitigationCheck` or `ManualReview` physically separates attribute disclosure from the outcome, eliminating "snap judgement" paths where a loan officer's (or algorithm's) immediate reaction to a demographic attribute becomes the decision.

---

### Combined Effect on the Process

```
StartApplication
      
      
[CheckApplicantRace / Age / Gender]    triggers both coexistence(ManualReview)
                                                    and response(BiasMitigationCheck)
        (nonchainsuccession: FinalDecision CANNOT be next)
BiasMitigationCheck
      
        (precedence enforced)
ManualReview
      
        (precedence enforced)
RequestAdditionalInfo    FinalDecision
```

The added constraints collectively ensure that **no decision can be made immediately or directly after examining a sensitive attribute**, and that **every trace containing sensitive-attribute disclosure is audited by both an automated bias check and a human reviewer** before any outcome is recorded.