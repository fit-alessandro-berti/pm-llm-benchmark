WITH ordered AS (
  SELECT
    case_id,
    activity,
    "timestamp",
    LAG(activity, 1) OVER (PARTITION BY case_id ORDER BY "timestamp") AS prev_act1,
    LAG(activity, 2) OVER (PARTITION BY case_id ORDER BY "timestamp") AS prev_act2,
    LAG("timestamp", 1) OVER (PARTITION BY case_id ORDER BY "timestamp") AS prev_ts1
  FROM event_log
),
bad_cases AS (
  SELECT DISTINCT case_id
  FROM ordered
  WHERE activity = 'Confirm Order'
    AND prev_act1 = 'Create Order'
    AND prev_act2 = 'Approve Purchase Requisition'
    AND "timestamp" - prev_ts1 > INTERVAL '5 days'
)
SELECT e.*
FROM event_log e
WHERE NOT EXISTS (
  SELECT 1 FROM bad_cases b WHERE b.case_id = e.case_id
)
ORDER BY e.case_id, e."timestamp";