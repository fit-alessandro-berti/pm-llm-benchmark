Below is a single DuckDB SQL statement that computes process variants, ranks them by frequency, and returns all events for cases belonging to the top K variants. Replace <K> with your desired integer.

WITH ordered AS (
  SELECT
    case_id,
    activity,
    timestamp,
    ROW_NUMBER() OVER (PARTITION BY case_id ORDER BY timestamp, activity) AS rn
  FROM event_log
),
seq AS (
  SELECT
    case_id,
    LIST(activity ORDER BY rn) AS activity_list
  FROM ordered
  GROUP BY case_id
),
variants AS (
  SELECT
    case_id,
    ARRAY_TO_STRING(activity_list, '->') AS variant
  FROM seq
),
variant_counts AS (
  SELECT
    variant,
    COUNT(*) AS case_count
  FROM variants
  GROUP BY variant
),
top_variants AS (
  SELECT
    variant
  FROM variant_counts
  ORDER BY case_count DESC, variant
  LIMIT <K>
),
selected_cases AS (
  SELECT v.case_id
  FROM variants v
  JOIN top_variants tv ON v.variant = tv.variant
)
SELECT e.*
FROM event_log e
JOIN selected_cases sc
  ON e.case_id = sc.case_id
ORDER BY e.case_id, e.timestamp, e.activity;