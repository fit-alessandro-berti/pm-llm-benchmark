You can do this in a single statement with a few CTEs. For example, to get the topK variants and all of their events:

```sql
-- set your desired K here
-- PRAGMA set_parameter('K', 5);

WITH case_variants AS (
  SELECT
    case_id,
    string_agg(activity, '->' ORDER BY "timestamp") AS variant
  FROM event_log
  GROUP BY case_id
),
variant_counts AS (
  SELECT
    variant,
    COUNT(*) AS case_count
  FROM case_variants
  GROUP BY variant
  ORDER BY case_count DESC
  LIMIT K  -- replace K with the number of variants you want
),
top_cases AS (
  SELECT cv.case_id
  FROM case_variants cv
  JOIN variant_counts vc USING (variant)
)
SELECT e.*
FROM event_log AS e
JOIN top_cases AS tc
  ON e.case_id = tc.case_id
ORDER BY e.case_id, e."timestamp";
```

`case_variants` builds the ordered activity sequence per case, `variant_counts` ranks the variants by how many cases follow them, `top_cases` picks the case_ids that belong to the topK variants, and the final `SELECT` returns only the events from those cases. Replace `K` with the number of top variants you want to keep.