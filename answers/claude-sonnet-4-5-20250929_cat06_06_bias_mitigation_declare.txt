# Updated DECLARE Model with Bias Mitigation Constraints

```python
declare_model = {
    "existence": {
        "StartApplication": {"support": 1.0, "confidence": 1.0},
        "FinalDecision": {"support": 1.0, "confidence": 1.0},
        "BiasMitigationCheck": {"support": 1.0, "confidence": 1.0},  # NEW: Ensure bias check always occurs
        "ManualReview": {"support": 1.0, "confidence": 1.0}  # NEW: Ensure manual review always occurs
    },
    "absence": {},
    "exactly_one": {},
    "init": {
        "StartApplication": {"support": 1.0, "confidence": 1.0}
    },
    "responded_existence": {},
    "coexistence": {
        "StartApplication": {"FinalDecision": {"support": 1.0, "confidence": 1.0}},
        "CheckApplicantRace": {"ManualReview": {"support": 1.0, "confidence": 1.0}},  # NEW: Race check requires manual review
        "CheckApplicantGender": {"ManualReview": {"support": 1.0, "confidence": 1.0}},  # NEW: Gender check requires manual review
        "CheckApplicantAge": {"ManualReview": {"support": 1.0, "confidence": 1.0}},  # NEW: Age check requires manual review
        "FinalDecision": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}}  # NEW: Decision requires bias check
    },
    "response": {
        "StartApplication": {"RequestAdditionalInfo": {"support": 1.0, "confidence": 1.0}},
        "CheckApplicantRace": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}},  # NEW: After race check, bias mitigation required
        "CheckApplicantGender": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}},  # NEW: After gender check, bias mitigation required
        "CheckApplicantAge": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}},  # NEW: After age check, bias mitigation required
        "BiasMitigationCheck": {"ManualReview": {"support": 1.0, "confidence": 1.0}}  # NEW: Bias check triggers manual review
    },
    "precedence": {
        "BiasMitigationCheck": {"FinalDecision": {"support": 1.0, "confidence": 1.0}},  # NEW: Bias check must precede decision
        "ManualReview": {"FinalDecision": {"support": 1.0, "confidence": 1.0}}  # NEW: Manual review must precede decision
    },
    "succession": {
        "RequestAdditionalInfo": {"FinalDecision": {"support": 1.0, "confidence": 1.0}},
        "BiasMitigationCheck": {"ManualReview": {"support": 1.0, "confidence": 1.0}}  # NEW: Bias check followed by manual review
    },
    "altresponse": {},
    "altprecedence": {},
    "altsuccession": {},
    "chainresponse": {},
    "chainprecedence": {},
    "chainsuccession": {},
    "noncoexistence": {},
    "nonsuccession": {
        "CheckApplicantRace": {"FinalDecision": {"support": 1.0, "confidence": 1.0}},  # NEW: Prevent direct race -> decision
        "CheckApplicantGender": {"FinalDecision": {"support": 1.0, "confidence": 1.0}},  # NEW: Prevent direct gender -> decision
        "CheckApplicantAge": {"FinalDecision": {"support": 1.0, "confidence": 1.0}}  # NEW: Prevent direct age -> decision
    },
    "nonchainsuccession": {
        "CheckApplicantRace": {"Reject": {"support": 1.0, "confidence": 1.0}},  # NEW: Prevent immediate race -> reject
        "CheckApplicantGender": {"Reject": {"support": 1.0, "confidence": 1.0}},  # NEW: Prevent immediate gender -> reject
        "CheckApplicantAge": {"Reject": {"support": 1.0, "confidence": 1.0}},  # NEW: Prevent immediate age -> reject
        "CheckApplicantRace": {"Approve": {"support": 1.0, "confidence": 1.0}},  # NEW: Prevent immediate race -> approve
        "CheckApplicantGender": {"Approve": {"support": 1.0, "confidence": 1.0}},  # NEW: Prevent immediate gender -> approve
        "CheckApplicantAge": {"Approve": {"support": 1.0, "confidence": 1.0}}  # NEW: Prevent immediate age -> approve
    }
}
```

## Rationale for Added Bias-Mitigating Constraints

### 1. **Existence Constraints**
- **`BiasMitigationCheck`**: Ensures that every process trace must include a bias mitigation check activity, guaranteeing that fairness considerations are evaluated in all loan applications.
- **`ManualReview`**: Requires that every application undergoes human oversight, preventing fully automated decisions that might perpetuate algorithmic bias.

### 2. **Coexistence Constraints**
- **Sensitive Attribute Checks  Manual Review**: Whenever sensitive attributes (race, gender, age) are checked, a manual review must occur in the same trace. This ensures human oversight when potentially discriminatory information is accessed.
- **`FinalDecision`  `BiasMitigationCheck`**: Any final decision must coexist with a bias mitigation check, ensuring fairness evaluation before conclusions are reached.

### 3. **Response Constraints**
- **Sensitive Checks  Bias Mitigation**: After checking any sensitive attribute, the system must eventually perform a bias mitigation check, creating an audit trail and intervention opportunity.
- **`BiasMitigationCheck`  `ManualReview`**: Establishes a chain where bias checks trigger manual reviews, ensuring that identified risks receive human attention.

### 4. **Precedence Constraints**
- **Bias Check & Manual Review  Decision**: Both bias mitigation checks and manual reviews must occur before any final decision, preventing premature or biased conclusions.

### 5. **Succession Constraints**
- **`BiasMitigationCheck`  `ManualReview`**: Ensures that bias mitigation activities are followed by manual review, creating a two-stage fairness verification process.

### 6. **Non-Succession Constraints**
- **Sensitive Checks  Final Decision**: Prevents any sensitive attribute check from being directly followed by a final decision, requiring intermediate processing steps that can catch and correct bias.

### 7. **Non-Chain-Succession Constraints**
- **Sensitive Checks  Approve/Reject**: Prevents immediate succession from sensitive attribute checks to specific decision outcomes (approve or reject), ensuring that decisions cannot be made directly based on protected characteristics without intervening fairness checks.

## Summary

These constraints create a **multi-layered fairness framework** that:
1. **Mandates oversight**: Requires both automated (BiasMitigationCheck) and human (ManualReview) fairness evaluations
2. **Prevents direct discrimination**: Blocks immediate paths from sensitive attribute access to decisions
3. **Enforces procedural fairness**: Establishes required sequences that ensure proper review before decisions
4. **Creates audit trails**: Ensures all traces contain evidence of fairness considerations

This approach significantly reduces the risk of biased decision-making by structurally preventing discriminatory patterns while maintaining process flexibility for legitimate business logic.