## BPMN-like textual process model — *Invoice Approval & Payment Scheduling (PO-based)*

### Participants (Pools/Lanes)
- **Pool: Supplier (external)**
- **Pool: Company**
  - **Lane: Accounts Payable (AP) Clerk** (Mary)
  - **Lane: Purchasing Officer** (Dan)
  - **Lane: Department Manager** (Carlos)
  - **Lane: AP Supervisor** (Rita)
  - **Lane: Supplier Relationship Manager** (Karen) *(exception support)*
  - **Lane: Accounting System** *(notifications/workflow + invoice record)*

### Key Artifacts / Data Objects
- **Invoice** (email/PDF)
- **Purchase Order (PO)** (PO number + PO record)
- **Contract / agreed terms** (used for pricing disputes)
- **Receipt / “goods/services received” confirmation** (email/record from Purchasing)
- **Invoice record in accounting system**
- **Manager approval decision** (approve / reject / hold-investigate)
- **Payment schedule / payment run entry**

---

## Main end-to-end flow (with gateways and exceptions)

### Start
**Start Event (Message):** *Invoice received from Supplier (usually via email) by AP Clerk*

---

### 1) Validate PO reference (AP)
**Task (AP Clerk):** Review invoice for **valid PO number**

**XOR Gateway G1: “PO number present and valid?”**
- **G1-No (missing/invalid PO):**
  - **Task (AP Clerk):** Email Supplier requesting PO / missing details (return for correction)
  - *(Optional exception support)* **Task (Supplier Relationship Manager):** Contact supplier to obtain PO or revised invoice (when AP/Purchasing flags issues)
  - **Intermediate Event (Message):** Supplier sends updated info / revised invoice  
  - **Loop:** Back to **Task: Review invoice for valid PO number**
  - *(Special case noted by Supervisor)*  
    - **Task (AP Supervisor):** If invoice relates to informally contracted services with no PO, coordinate with department heads to **create retrospective PO** *or* decide to reject  
    - **XOR Gateway G1b: “Retrospective PO created/approved?”**
      - **Yes:** continue to “Log invoice”
      - **No:** **End Event:** *Invoice rejected (no PO); supplier notified*
- **G1-Yes (PO present):**
  - Continue

---

### 2) Register invoice (AP)
**Task (AP Clerk):** Log invoice into **accounting system** (create invoice record)

**Task (AP Clerk):** Forward invoice / PO reference to **Purchasing** for confirmation (goods/services received + PO alignment)

---

### 3) Purchasing verification (Purchasing)
**Task (Purchasing Officer):** Open PO and compare **quantities, prices, delivery charges**; confirm goods/services receipt aligns with PO  
*(Purchasing also re-checks PO existence; “never approve anything without confirmed PO reference.”)*

**XOR Gateway G2: “Any discrepancy / missing information?”**
- **G2-No (all OK):**
  - **Task (Purchasing Officer):** Send **confirmation email** to AP (receipt/alignment confirmed)
  - Continue to AP matching step
- **G2-Yes (issues found):**
  - **Task (Purchasing Officer):** Contact Supplier directly **OR** request AP to **hold invoice** pending correction (supplier sends corrected invoice / info)
  - *(Optional exception support)* **Task (Supplier Relationship Manager):** Validate pricing/terms against contract; inform AP/Purchasing of correct terms; obtain revised invoice/PO info from supplier
  - **XOR Gateway G2b: “Issue resolved without escalation?”**
    - **Yes:** **Task (Purchasing Officer):** Send updated confirmation to AP  continue
    - **No / stuck:** **Task (AP Clerk):** Escalate exception to **AP Supervisor**
      - **Task (AP Supervisor):** Coordinate resolution across supplier + departments; decide corrective action (incl. retrospective PO or rejection)
      - **XOR Gateway G2c: “Resolved and can proceed?”**
        - **Yes:** Return to **Task (Purchasing Officer): Purchasing verification**
        - **No:** **End Event:** *Invoice rejected; supplier notified*

---

### 4) AP matching (AP)
**Task (AP Clerk):** Match invoice line items against PO in the system (after Purchasing confirmation)

**XOR Gateway G3: “Invoice matches PO (post-clarifications)?”**
- **G3-Yes:**
  - Continue to manager approval request
- **G3-No:**
  - **Task (AP Clerk):** Email Purchasing to clarify discrepancy (pricing/missing items/etc.)
  - **XOR Gateway G3b: “Resolved quickly?”**
    - **Yes:** Return to **Task: Match invoice line items**
    - **No:** **Task (AP Clerk):** Escalate to **AP Supervisor**
      - **Task (AP Supervisor):** Coordinate resolution (may involve Supplier Relationship Manager and/or supplier contact)
      - **XOR Gateway G3c: “Resolved?”**
        - **Yes:** Return to **Task: Match invoice line items**
        - **No:** **End Event:** *Invoice rejected / closed as unresolved*

---

### 5) Manager approval (System + Manager)
**Task (Accounting System):** Send automatic **approval request/notification** to Department Manager (triggered after receipt confirmation + matching)

**Task (Department Manager):** Review invoice + PO + Purchasing confirmation (and budget/suspicion checks)

**XOR Gateway G4: “Manager approves?”**
- **G4-Approve:**
  - **Task (AP Clerk):** Schedule invoice for **payment run / next payment cycle**
  - **End Event:** *Invoice scheduled for payment* *(actual payment execution not described in interviews)*
- **G4-Reject or Hold/Investigate:**
  - **Task (Department Manager):** Reject in system or request AP to hold & investigate
  - **Task (AP Clerk):** Place invoice on hold; investigate (with Purchasing / Supplier Relationship Manager / AP Supervisor as needed)
  - **XOR Gateway G4b: “Issue resolved and invoice can be resubmitted?”**
    - **Yes:** Return to **Task (Accounting System): Send approval request** (resubmit for manager approval)
    - **No:** **End Event:** *Invoice rejected after investigation; supplier notified*

---

## Noted variations / ambiguities from interviews
- **Overlap in “matching” work:** Purchasing performs detailed comparison of invoice vs PO; AP also performs a system match. Modeled as sequential checks (Purchasing confirmation  AP match), but in practice some orgs treat this as a combined “3way match” activity.
- **Where supplier contact happens:** Dan may contact the supplier directly; AP/Supervisor/Karen may also contact supplier depending on issue type and severity.
- **End point scope:** Interviews consistently end at **“scheduled for payment”**; the downstream payment execution/settlement steps are out of scope here.