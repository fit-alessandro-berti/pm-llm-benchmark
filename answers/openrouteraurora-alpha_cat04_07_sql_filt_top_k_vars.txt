Below is a singlestatement (with CTEs) DuckDB query that does everything you asked for.  
Replace **`?`** (or `:K`) with the number of top variants you want to keep (e.g.10).

```sql
/* -------------------------------------------------------------
   1  Build the ordered activity string for every case
   2  Count how many cases share each exact sequence (variant)
   3  Keep only the K most frequent variants
   4  Return every original event that belongs to a case whose
       variant is in that topK set
   ------------------------------------------------------------- */

WITH
/* -------------------------------------------------------------
   Step 1 – one row per case, with the full ordered activity list
   ------------------------------------------------------------- */
case_variants AS (
    SELECT
        case_id,
        STRING_AGG(activity, '|' ORDER BY timestamp) AS variant   -- '|' is just a delimiter
    FROM event_log
    GROUP BY case_id
),

/* -------------------------------------------------------------
   Step 2 – how many cases per variant
   ------------------------------------------------------------- */
variant_counts AS (
    SELECT
        variant,
        COUNT(*) AS case_cnt
    FROM case_variants
    GROUP BY variant
),

/* -------------------------------------------------------------
   Step 3 – the K most frequent variants (K = ?)
   ------------------------------------------------------------- */
top_variants AS (
    SELECT
        variant
    FROM variant_counts
    ORDER BY case_cnt DESC
    LIMIT ?
),

/* -------------------------------------------------------------
   Step 4 – the case_ids that belong to those topK variants
   ------------------------------------------------------------- */
top_cases AS (
    SELECT
        cv.case_id,
        cv.variant
    FROM case_variants cv
    JOIN top_variants tv ON cv.variant = tv.variant
)

-- -------------------------------------------------------------
-- Final result: every row from the original log that belongs to a
-- case whose variant is among the topK most frequent ones.
-- -------------------------------------------------------------
SELECT
    el.*
FROM event_log el
JOIN top_cases tc
      ON el.case_id = tc.case_id
ORDER BY el.case_id, el.timestamp;
```

### How it works  

| CTE | Purpose |
|-----|---------|
| **`case_variants`** | For each `case_id` we concatenate the `activity` values **in timestamp order** (`STRING_AGG(... ORDER BY timestamp)`). The resulting string (e.g. `A|B|C|D`) uniquely identifies the process variant of that case. |
| **`variant_counts`** | Groups the variant strings and counts how many distinct cases share each one (`COUNT(*)`). |
| **`top_variants`** | Orders the variants by their frequency (`case_cnt`) and keeps only the first **K** rows (`LIMIT ?`). |
| **`top_cases`** | Joins the percase variant list back to the topK variant set, yielding the list of `case_id`s that we want to keep. |
| **final SELECT** | Joins those `case_id`s to the original `event_log`, returning **all events** for the selected cases, ordered by case and timestamp. |

#### Customising the delimiter / format
- The delimiter (`'|'`) can be any character that will never appear in an activity name, or you can use `ARRAY_AGG(activity ORDER BY timestamp)` together with `ARRAY_TO_STRING(..., '|')` if you prefer an explicit array step.  
- If you also want to see the variant string and its frequency alongside each event, just add `tc.variant, vc.case_cnt` to the final `SELECT` list (joining `variant_counts` again if needed).

That’s it – a single, portable DuckDB query that extracts the ordered activity sequence per case, identifies the most common variants, and returns only the events belonging to those topK variants.