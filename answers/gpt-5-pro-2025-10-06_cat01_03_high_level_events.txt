Proposed high-level steps (names)
- S1 Material Preparation & Staging
- S2 Welding Setup & Join
- S3 In-Process Weld Quality Check
- S4 Surface Coating & Cure
- S5 Final Visual Inspection

Why these groupings
- S1 groups material receipt, identification, positioning, and thermal prep. These actions transform the raw sheet into a staged, weld-ready workpiece. They are temporally contiguous, logically preparatory, and involve handling, alignment, and preheating resources.
- S2 groups tool acquisition and all weld operations. These are performed by the same resource type (welding operator/tool), are contiguous in time, and represent the joining transformation.
- S3 isolates sensor-based verification of weld quality. It is a distinct QA phase with specialized resource(s) and occurs immediately after welding, potentially gating downstream steps.
- S4 groups surface finishing actions (coating application and thermal drying/cure). These are logically post-join finishing operations using coating and heating resources.
- S5 is a human-centric final conformance check after finishing, representing the release/acceptance gate.

Grouping rules (to apply to the full log)
- S1 starts at the first occurrence of any “retrieve raw metal sheet” (or equivalent) for a CaseID. Include activities: retrieve/identify/scan/place/align/preheat performed by operators, robots, or heating units. S1 ends when the first welding-related activity (S2 start) occurs.
- S2 starts at “pick up welding tool” or first “weld*” activity. Include all weld-related actions until the first quality measurement activity (S3 start).
- S3 starts at “measure weld integrity” (or any weld quality sensor measurement). Ends at first coating-related activity (S4 start).
- S4 starts at “apply protective coating.” Include coating application and drying/cure activities until a human visual inspection begins (S5 start).
- S5 starts at “visual check” (or equivalent final inspection). Ends at case end.
- Time proximity heuristic: events within a step are typically separated by less than ~60–120 seconds; however, step boundaries are primarily anchored by the start triggers above.
- Rework logic (if present in full log): If S3 result indicates failure (e.g., IntegrityScore below threshold), a rework loop may return to S2 for additional weld(s) followed by another S3.

Structured output
{
  "model_version": "1.0",
  "high_level_steps": [
    {
      "id": "S1",
      "name": "Material Preparation & Staging",
      "start_triggers": ["Retrieve raw metal sheet"],
      "include_activities": ["Retrieve raw metal sheet", "Scan barcode", "Place metal sheet on table", "Align metal sheet", "Preheat metal sheet"],
      "end_trigger_is_next_step_start": "S2"
    },
    {
      "id": "S2",
      "name": "Welding Setup & Join",
      "start_triggers": ["Pick up welding tool", "Weld*"],
      "include_activities": ["Pick up welding tool", "Weld*"],
      "end_trigger_is_next_step_start": "S3"
    },
    {
      "id": "S3",
      "name": "In-Process Weld Quality Check",
      "start_triggers": ["Measure weld integrity"],
      "include_activities": ["Measure weld integrity"],
      "end_trigger_is_next_step_start": "S4"
    },
    {
      "id": "S4",
      "name": "Surface Coating & Cure",
      "start_triggers": ["Apply protective coating"],
      "include_activities": ["Apply protective coating", "Dry coating", "Cure coating"],
      "end_trigger_is_next_step_start": "S5"
    },
    {
      "id": "S5",
      "name": "Final Visual Inspection",
      "start_triggers": ["Visual check"],
      "include_activities": ["Visual check", "Record inspection result", "Label pass/fail"],
      "end_trigger": "CaseEnd"
    }
  ],
  "aggregated_cases": [
    {
      "CaseID": "A1",
      "steps": [
        {
          "step_id": "S1",
          "name": "Material Preparation & Staging",
          "start_time": "2024-03-01 08:00:05",
          "end_time": "2024-03-01 08:00:20",
          "duration_seconds": 15,
          "included_events": [
            {"ts": "2024-03-01 08:00:05", "activity": "Retrieve raw metal sheet", "resource": "Operator A", "info": "PartID: M-045"},
            {"ts": "2024-03-01 08:00:07", "activity": "Scan barcode", "resource": "Operator A", "info": "Barcode: 12345"},
            {"ts": "2024-03-01 08:00:10", "activity": "Place metal sheet on table", "resource": "Operator A", "info": "TableID: T-3"},
            {"ts": "2024-03-01 08:00:15", "activity": "Align metal sheet", "resource": "Robot Arm #2", "info": "Alignment: Perfect"},
            {"ts": "2024-03-01 08:00:20", "activity": "Preheat metal sheet", "resource": "Heating Unit #1", "info": "Temperature: 200°C"}
          ],
          "key_data": {"PartID": "M-045", "PreheatTemp_C": 200}
        },
        {
          "step_id": "S2",
          "name": "Welding Setup & Join",
          "start_time": "2024-03-01 08:01:00",
          "end_time": "2024-03-01 08:01:10",
          "duration_seconds": 10,
          "included_events": [
            {"ts": "2024-03-01 08:01:00", "activity": "Pick up welding tool", "resource": "Operator B", "info": "ToolID: W-12"},
            {"ts": "2024-03-01 08:01:05", "activity": "Weld corner A", "resource": "Operator B", "info": "WeldType: Spot"},
            {"ts": "2024-03-01 08:01:10", "activity": "Weld corner B", "resource": "Operator B", "info": "WeldType: Spot"}
          ]
        },
        {
          "step_id": "S3",
          "name": "In-Process Weld Quality Check",
          "start_time": "2024-03-01 08:01:20",
          "end_time": "2024-03-01 08:01:20",
          "duration_seconds": 0,
          "included_events": [
            {"ts": "2024-03-01 08:01:20", "activity": "Measure weld integrity", "resource": "Quality Sensor #1", "info": "IntegrityScore: 95"}
          ],
          "key_data": {"IntegrityScore": 95}
        },
        {
          "step_id": "S4",
          "name": "Surface Coating & Cure",
          "start_time": "2024-03-01 08:01:30",
          "end_time": "2024-03-01 08:01:45",
          "duration_seconds": 15,
          "included_events": [
            {"ts": "2024-03-01 08:01:30", "activity": "Apply protective coating", "resource": "Coating Unit #3", "info": "CoatingType: Polyurethane"},
            {"ts": "2024-03-01 08:01:45", "activity": "Dry coating", "resource": "Heating Unit #2", "info": "Temperature: 120°C"}
          ],
          "key_data": {"CoatingType": "Polyurethane", "DryTemp_C": 120}
        },
        {
          "step_id": "S5",
          "name": "Final Visual Inspection",
          "start_time": "2024-03-01 08:02:00",
          "end_time": "2024-03-01 08:02:00",
          "duration_seconds": 0,
          "included_events": [
            {"ts": "2024-03-01 08:02:00", "activity": "Visual check", "resource": "Operator C", "info": "Check: Passed"}
          ],
          "key_data": {"VisualCheck": "Passed"}
        }
      ]
    },
    {
      "CaseID": "B2",
      "steps": [
        {
          "step_id": "S1",
          "name": "Material Preparation & Staging",
          "start_time": "2024-03-01 08:00:05",
          "end_time": "2024-03-01 08:00:25",
          "duration_seconds": 20,
          "included_events": [
            {"ts": "2024-03-01 08:00:05", "activity": "Retrieve raw metal sheet", "resource": "Operator A", "info": "PartID: M-046"},
            {"ts": "2024-03-01 08:00:08", "activity": "Scan barcode", "resource": "Operator A", "info": "Barcode: 12346"},
            {"ts": "2024-03-01 08:00:12", "activity": "Place metal sheet on table", "resource": "Operator A", "info": "TableID: T-3"},
            {"ts": "2024-03-01 08:00:18", "activity": "Align metal sheet", "resource": "Robot Arm #2", "info": "Alignment: Perfect"},
            {"ts": "2024-03-01 08:00:25", "activity": "Preheat metal sheet", "resource": "Heating Unit #1", "info": "Temperature: 200°C"}
          ],
          "key_data": {"PartID": "M-046", "PreheatTemp_C": 200}
        },
        {
          "step_id": "S2",
          "name": "Welding Setup & Join",
          "start_time": "2024-03-01 08:01:03",
          "end_time": "2024-03-01 08:01:12",
          "duration_seconds": 9,
          "included_events": [
            {"ts": "2024-03-01 08:01:03", "activity": "Pick up welding tool", "resource": "Operator B", "info": "ToolID: W-12"},
            {"ts": "2024-03-01 08:01:08", "activity": "Weld corner A", "resource": "Operator B", "info": "WeldType: Spot"},
            {"ts": "2024-03-01 08:01:12", "activity": "Weld corner B", "resource": "Operator B", "info": "WeldType: Spot"}
          ]
        },
        {
          "step_id": "S3",
          "name": "In-Process Weld Quality Check",
          "start_time": "2024-03-01 08:01:22",
          "end_time": "2024-03-01 08:01:22",
          "duration_seconds": 0,
          "included_events": [
            {"ts": "2024-03-01 08:01:22", "activity": "Measure weld integrity", "resource": "Quality Sensor #1", "info": "IntegrityScore: 93"}
          ],
          "key_data": {"IntegrityScore": 93}
        },
        {
          "step_id": "S4",
          "name": "Surface Coating & Cure",
          "start_time": "2024-03-01 08:01:35",
          "end_time": "2024-03-01 08:01:50",
          "duration_seconds": 15,
          "included_events": [
            {"ts": "2024-03-01 08:01:35", "activity": "Apply protective coating", "resource": "Coating Unit #3", "info": "CoatingType: Polyurethane"},
            {"ts": "2024-03-01 08:01:50", "activity": "Dry coating", "resource": "Heating Unit #2", "info": "Temperature: 120°C"}
          ],
          "key_data": {"CoatingType": "Polyurethane", "DryTemp_C": 120}
        },
        {
          "step_id": "S5",
          "name": "Final Visual Inspection",
          "start_time": "2024-03-01 08:02:05",
          "end_time": "2024-03-01 08:02:05",
          "duration_seconds": 0,
          "included_events": [
            {"ts": "2024-03-01 08:02:05", "activity": "Visual check", "resource": "Operator C", "info": "Check: Passed"}
          ],
          "key_data": {"VisualCheck": "Passed"}
        }
      ]
    }
  ]
}

How to use this on the full log
- Sort events by CaseID and Timestamp.
- Scan per case and segment using the start triggers for S1–S5. Assign events to the current step if their activity matches that step’s include_activities until the next step’s start trigger occurs.
- Optionally compute durations from earliest to latest event within each step and extract key_data to support KPIs (e.g., preparation time, weld time, coating cycle, pass rates).