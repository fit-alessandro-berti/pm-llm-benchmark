## Prompt for the Target LLM (copy/paste)

You are an expert **process mining + compliance analyst** with strong **PostgreSQL** skills. You will be given an event log extracted from an order-to-cash process and its database schema. Your job is to (1) detect anomalies/deviations, (2) propose plausible root causes, and (3) write SQL queries to investigate and quantify them.

### Database (PostgreSQL) — Available Tables

**`order_event_log`**
- `case_id` (INTEGER) – order identifier
- `event_id` (INTEGER) – primary key of event record
- `activity` (VARCHAR) – activity name
- `timestamp` (TIMESTAMP) – time of the event
- `resource` (VARCHAR) – person/system executing
- `additional_info` (VARCHAR) – free-text key/value context

**`orders`**
- `case_id` (INTEGER)
- `customer_id` (INTEGER)
- `order_type` (VARCHAR)
- `order_value` (DECIMAL)

**`resources`**
- `resource_id` (VARCHAR)
- `role` (VARCHAR)
- `department` (VARCHAR)

### Assumed “Normal” Process Flow (expected order)
1. Register Order (Sales)  
2. Perform Credit Check (Finance)  
3. Validate Stock (Warehouse/Logistics)  
4. Confirm Shipment (Logistics)  
5. Ship Goods (Logistics)  
6. Issue Invoice (Finance)  
7. Receive Payment (Finance)

---

## Your Tasks

### 1) Rapid process understanding
- Infer the **observed** common sequences of activities across `case_id`s.
- Compare observed behavior to the **assumed normal flow** (conformance perspective).

### 2) Identify anomalies / undesirable behaviors
Find and clearly describe deviations such as (examples of *categories*, not an exhaustive list):
- Steps occurring in unexpected order
- Missing required steps, or extra/unexpected steps
- Duplicated steps (rework loops)
- Suspicious timing patterns (very long/short durations, negative time gaps, simultaneous timestamps)
- Resource/role/department mismatches vs. activity responsibility
- Patterns tied to `order_type`, `order_value`, `customer_id`, or specific resources/departments
- Anything suspicious embedded in `additional_info` (reason codes, flags, etc.)

For each anomaly you identify:
- Cite **specific evidence** (case_ids, activities, timestamps, involved resources).
- Explain why it is problematic (risk, policy violation, financial exposure, customer impact, fraud risk, etc.).

### 3) Hypothesize root causes
For each anomaly category, propose plausible explanations (e.g., training gaps, system configuration, workarounds, integration delays, approval bypassing, data quality issues, role misassignment, etc.). Keep hypotheses grounded in the data you have.

### 4) Propose SQL queries to investigate further (PostgreSQL)
Write SQL queries that would let an analyst **find all instances** of each anomaly and **measure prevalence**. Use only the provided tables/columns.

Requirements for SQL:
- PostgreSQL syntax
- Prefer **CTEs** and **window functions** (`LAG`, `LEAD`, `ROW_NUMBER`) where helpful
- Queries should be runnable as-is (no pseudo-SQL)
- Include brief notes above each query: *what it detects* and *how to interpret results*
- When relevant, provide both:
  - a “list cases” query (details per case/event)
  - a “summary” query (counts, percentages, breakdown by order_type/department/resource)

### 5) Output format (strict)
Produce your answer in this structure:

1. **Observed process variants (high-level)**  
2. **Anomalies detected**  
   - A1: *Name*  
     - Evidence  
     - Why it matters  
     - Hypotheses  
     - SQL to detect + quantify  
   - A2: …  
3. **Prioritized next investigations** (top 3–5, based on risk/impact)  

Do not assume any additional data beyond the schema. Avoid generic textbook explanations—tie your reasoning to the log content and what can be verified with SQL.