# Temporal Profile Analysis: Insurance Claim Handling Process

## 1. Identified Anomalies

### Anomaly 1: Receive to Approve (R  P)
- **Average Time:** ~25 hours
- **Standard Deviation:** 1 hour
- **Observation:** The standard deviation is remarkably low relative to the average, suggesting an unusually rigid and predictable approval timeline that does not reflect natural process variation.

### Anomaly 2: Approve to Notify (P  N)
- **Average Time:** 7 days
- **Standard Deviation:** 2 days
- **Observation:** An excessive delay between approval and customer notification with significant variance indicates inconsistent handling and potential customer service issues.

### Anomaly 3: Assign to Close (A  C)
- **Average Time:** 2 hours
- **Standard Deviation:** 1 hour
- **Observation:** Claims are being closed very rapidly after assignment, suggesting that intermediate steps (Evaluate, Approve, Notify) may be bypassed or occur in unexpected order.

### Anomaly 4: Evaluate to Notify (E  N)
- **Average Time:** 5 minutes
- **Standard Deviation:** 1 minute
- **Observation:** The transition is suspiciously fast and consistent, indicating possible automation that may skip the approval step or batch processing that conflates these activities.

---

## 2. Hypotheses for Anomaly Causes

| Anomaly | Possible Explanations |
|---------|----------------------|
| **R  P (Low STDEV)** | Automated batch approval processes running on fixed schedules; Approval timestamps being backdated or system-generated; Rigid SLA enforcement creating artificial consistency |
| **P  N (Long Delay)** | Resource bottleneck in the notification department; Manual notification process requiring human intervention; Batch notification jobs running weekly; Pending documentation requirements before customer contact |
| **A  C (Rapid Closure)** | Claims being incorrectly closed as duplicates; Automated rejection of invalid claims; Adjuster reassignments logged as closures; Fraudulent claim handling to meet quotas |
| **E  N (Too Fast)** | Automated notification triggers immediately after evaluation; Evaluation and notification performed by same resource in quick succession; Approval step being skipped for certain claim types; System timestamp granularity issues |

---

## 3. Verification SQL Queries

### 3.1 Detecting R  P Anomaly: Claims with Suspiciously Consistent Approval Times

```sql
-- Find claims where Receive-to-Approve time is within 1 STDEV of the mean
-- indicating suspiciously rigid timing
WITH approval_times AS (
    SELECT 
        r.claim_id,
        r.timestamp AS receive_time,
        p.timestamp AS approve_time,
        EXTRACT(EPOCH FROM (p.timestamp - r.timestamp)) AS time_diff_seconds
    FROM claim_events r
    JOIN claim_events p ON r.claim_id = p.claim_id
    WHERE r.activity = 'R' AND p.activity = 'P'
)
SELECT 
    claim_id,
    receive_time,
    approve_time,
    time_diff_seconds,
    ROUND(time_diff_seconds / 3600.0, 2) AS time_diff_hours
FROM approval_times
WHERE time_diff_seconds BETWEEN 86400 AND 93600  -- Within tight band around 25 hours
ORDER BY time_diff_seconds;
```

```sql
-- Analyze distribution of RP times to detect artificial clustering
SELECT 
    DATE_TRUNC('hour', approve_time) AS approval_hour,
    COUNT(*) AS claims_approved
FROM (
    SELECT 
        p.claim_id,
        p.timestamp AS approve_time
    FROM claim_events r
    JOIN claim_events p ON r.claim_id = p.claim_id
    WHERE r.activity = 'R' AND p.activity = 'P'
) subq
GROUP BY DATE_TRUNC('hour', approve_time)
ORDER BY claims_approved DESC
LIMIT 20;
```

---

### 3.2 Detecting P  N Anomaly: Claims with Excessive Notification Delays

```sql
-- Find claims where notification occurs more than 5 days after approval
WITH notify_delays AS (
    SELECT 
        p.claim_id,
        p.timestamp AS approve_time,
        n.timestamp AS notify_time,
        n.resource AS notifying_resource,
        EXTRACT(EPOCH FROM (n.timestamp - p.timestamp)) / 86400 AS days_delayed
    FROM claim_events p
    JOIN claim_events n ON p.claim_id = n.claim_id
    WHERE p.activity = 'P' AND n.activity = 'N'
)
SELECT 
    nd.claim_id,
    nd.approve_time,
    nd.notify_time,
    ROUND(nd.days_delayed, 2) AS days_delayed,
    nd.notifying_resource,
    c.claim_type,
    c.claim_amount
FROM notify_delays nd
JOIN claims c ON nd.claim_id = c.claim_id
WHERE nd.days_delayed > 5
ORDER BY nd.days_delayed DESC;
```

```sql
-- Correlate long PN delays with specific resources or regions
SELECT 
    a.region,
    a.name AS adjuster_name,
    COUNT(*) AS delayed_notifications,
    ROUND(AVG(EXTRACT(EPOCH FROM (n.timestamp - p.timestamp)) / 86400), 2) AS avg_days_delayed
FROM claim_events p
JOIN claim_events n ON p.claim_id = n.claim_id
JOIN claim_events assign_evt ON p.claim_id = assign_evt.claim_id AND assign_evt.activity = 'A'
JOIN adjusters a ON assign_evt.resource = a.name
WHERE p.activity = 'P' 
  AND n.activity = 'N'
  AND EXTRACT(EPOCH FROM (n.timestamp - p.timestamp)) > 432000  -- > 5 days
GROUP BY a.region, a.name
ORDER BY delayed_notifications DESC;
```

---

### 3.3 Detecting A  C Anomaly: Claims Closed Prematurely After Assignment

```sql
-- Identify claims closed within 3 hours of assignment without proper intermediate steps
WITH claim_lifecycle AS (
    SELECT 
        a.claim_id,
        a.timestamp AS assign_time,
        c.timestamp AS close_time,
        EXTRACT(EPOCH FROM (c.timestamp - a.timestamp)) / 3600 AS hours_to_close
    FROM claim_events a
    JOIN claim_events c ON a.claim_id = c.claim_id
    WHERE a.activity = 'A' AND c.activity = 'C'
),
intermediate_steps AS (
    SELECT 
        claim_id,
        BOOL_OR(activity = 'E') AS has_evaluation,
        BOOL_OR(activity = 'P') AS has_approval,
        BOOL_OR(activity = 'N') AS has_notification
    FROM claim_events
    WHERE activity IN ('E', 'P', 'N')
    GROUP BY claim_id
)
SELECT 
    cl.claim_id,
    cl.assign_time,
    cl.close_time,
    ROUND(cl.hours_to_close, 2) AS hours_to_close,
    COALESCE(ist.has_evaluation, FALSE) AS has_evaluation,
    COALESCE(ist.has_approval, FALSE) AS has_approval,
    COALESCE(ist.has_notification, FALSE) AS has_notification,
    c.claim_type,
    c.claim_amount
FROM claim_lifecycle cl
LEFT JOIN intermediate_steps ist ON cl.claim_id = ist.claim_id
JOIN claims c ON cl.claim_id = c.claim_id
WHERE cl.hours_to_close < 3
ORDER BY cl.hours_to_close;
```

```sql
-- Check if rapid closures correlate with specific adjusters
SELECT 
    ce.resource AS adjuster,
    COUNT(*) AS rapid_closures,
    ROUND(AVG(EXTRACT(EPOCH FROM (c.timestamp - a.timestamp)) / 3600), 2) AS avg_hours_to_close
FROM claim_events a
JOIN claim_events c ON a.claim_id = c.claim_id
JOIN claim_events ce ON a.claim_id = ce.claim_id AND ce.activity = 'A'
WHERE a.activity = 'A' 
  AND c.activity = 'C'
  AND EXTRACT(EPOCH FROM (c.timestamp - a.timestamp)) < 10800  -- < 3 hours
GROUP BY ce.resource
ORDER BY rapid_closures DESC;
```

---

### 3.4 Detecting E  N Anomaly: Suspiciously Fast Evaluate-to-Notify Transitions

```sql
-- Find claims with EN transition under 10 minutes and check for skipped approval
WITH fast_transitions AS (
    SELECT 
        e.claim_id,
        e.timestamp AS evaluate_time,
        n.timestamp AS notify_time,
        e.resource AS evaluator,
        EXTRACT(EPOCH FROM (n.timestamp - e.timestamp)) / 60 AS minutes_elapsed
    FROM claim_events e
    JOIN claim_events n ON e.claim_id = n.claim_id
    WHERE e.activity = 'E' AND n.activity = 'N'
),
approval_check AS (
    SELECT claim_id, MIN(timestamp) AS approval_time
    FROM claim_events
    WHERE activity = 'P'
    GROUP BY claim_id
)
SELECT 
    ft.claim_id,
    ft.evaluate_time,
    ft.notify_time,
    ROUND(ft.minutes_elapsed, 2) AS minutes_elapsed,
    ft.evaluator,
    CASE WHEN ac.approval_time IS NULL THEN 'MISSING'
         WHEN ac.approval_time < ft.evaluate_time THEN 'BEFORE_EVAL'
         WHEN ac.approval_time > ft.notify_time THEN 'AFTER_NOTIFY'
         ELSE 'NORMAL' END AS approval_status,
    c.claim_type
FROM fast_transitions ft
LEFT JOIN approval_check ac ON ft.claim_id = ac.claim_id
JOIN claims c ON ft.claim_id = c.claim_id
WHERE ft.minutes_elapsed < 10
ORDER BY ft.minutes_elapsed;
```

```sql
-- Aggregate by claim type to identify if certain types bypass approval
SELECT 
    c.claim_type,
    COUNT(*) AS total_fast_transitions,
    SUM(CASE WHEN p.claim_id IS NULL THEN 1 ELSE 0 END) AS missing_approval_count,
    ROUND(100.0 * SUM(CASE WHEN p.claim_id IS NULL THEN 1 ELSE 0 END) / COUNT(*), 2) AS pct_missing_approval
FROM claim_events e
JOIN claim_events n ON e.claim_id = n.claim_id
JOIN claims c ON e.claim_id = c.claim_id
LEFT JOIN claim_events p ON e.claim_id = p.claim_id AND p.activity = 'P'
WHERE e.activity = 'E' 
  AND n.activity = 'N'
  AND EXTRACT(EPOCH FROM (n.timestamp - e.timestamp)) < 600  -- < 10 minutes
GROUP BY c.claim_type
ORDER BY pct_missing_approval DESC;
```

---

### 3.5 Comprehensive Anomaly Summary Query

```sql
-- Generate a summary of all timing anomalies per claim
WITH activity_pairs AS (
    SELECT 
        e1.claim_id,
        e1.activity AS activity1,
        e2.activity AS activity2,
        EXTRACT(EPOCH FROM (e2.timestamp - e1.timestamp)) AS time_diff
    FROM claim_events e1
    JOIN claim_events e2 ON e1.claim_id = e2.claim_id AND e2.timestamp > e1.timestamp
),
anomaly_flags AS (
    SELECT 
        claim_id,
        MAX(CASE WHEN activity1 = 'R' AND activity2 = 'P' 
                  AND time_diff BETWEEN 86400 AND 93600 THEN 1 ELSE 0 END) AS rigid_approval,
        MAX(CASE WHEN activity1 = 'P' AND activity2 = 'N' 
                  AND time_diff > 432000 THEN 1 ELSE 0 END) AS delayed_notify,
        MAX(CASE WHEN activity1 = 'A' AND activity2 = 'C' 
                  AND time_diff < 10800 THEN 1 ELSE 0 END) AS premature_close,
        MAX(CASE WHEN activity1 = 'E' AND activity2 = 'N' 
                  AND time_diff < 600 THEN 1 ELSE 0 END) AS fast_eval_notify
    FROM activity_pairs
    GROUP BY claim_id
)
SELECT 
    c.claim_id,
    c.claim_type,
    c.claim_amount,
    af.rigid_approval,
    af.delayed_notify,
    af.premature_close,
    af.fast_eval_notify,
    (af.rigid_approval + af.delayed_notify + af.premature_close + af.fast_eval_notify) AS total_anomalies
FROM anomaly_flags af
JOIN claims c ON af.claim_id = c.claim_id
WHERE (af.rigid_approval + af.delayed_notify + af.premature_close + af.fast_eval_notify) > 0
ORDER BY total_anomalies DESC, c.claim_id;
```

---

## Summary

The temporal profile reveals several process control weaknesses:

| Anomaly | Risk Level | Recommended Action |
|---------|------------|-------------------|
| R  P rigid timing | Medium | Audit batch approval processes |
| P  N long delays | High | Review notification resource allocation |
| A  C premature closure | Critical | Implement closure validation rules |
| E  N rapid transition | Medium | Verify approval step enforcement |