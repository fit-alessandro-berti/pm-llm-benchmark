## 1) Identifying instance-spanning constraints and quantifying their impact

### A. Shared packing stations (incl. limited Cold-Packing)
**Goal:** quantify waiting and delay caused by contention for specific station pools (Standard vs Cold-Packing), and how much of total lead time it explains.

**How to identify with the event log**
- Use **start/complete** timestamps to compute:
  - Activity duration = `complete(Packing) – start(Packing)`
  - Pre-activity waiting/queue time = `start(Packing) – complete(previous activity)` (typically after Item Picking complete)
- Use **Resource (Station ID)** to build station calendars and detect overlap:
  - For each station, reconstruct busy intervals `[start, complete]` and compute utilization and queue buildup periods.
- Use attribute **Requires Cold Packing** to split cases:
  - Compare queue time distributions for Packing of cold vs non-cold orders.
- Detect “resource pool constraint” explicitly:
  - Cold-packing capacity = number of distinct cold stations (e.g., C1–C5).
  - Measure times when all cold stations are simultaneously busy, and correlate with spikes in queue time.

**Impact metrics**
- **Cold-packing queue time**: `Q_cold = start(Packing) – complete(Picking)` for cold orders.
- **Probability of waiting**: % of cold orders where `Q_cold > 0` (or > small threshold).
- **Station utilization** (cold pool and standard pool): busy time / available time.
- **Time-in-state “blocked for cold station”**: total time orders spend waiting specifically for cold station capacity.
- **Throughput impact**: change in completed orders/day during periods when cold stations are saturated.

---

### B. Batching for Shipping Label Generation (by Destination Region)
**Goal:** quantify delay introduced by “batch waiting” after upstream work is done.

**How to identify with the event log**
- Use the “System (Batch ID)” concept if present (e.g., Batch B1). If not reliably logged, infer batches by:
  - Same **Destination Region** + label generation times within a batch window (e.g., within X minutes) + same system resource or batch key.
- Compute “ready-to-batch” time:
  - `ready = complete(Quality Check)` (or last pre-label step complete)
  - `label_time = complete(Shipping Label Gen.)` (often instantaneous but delayed by batch formation)
- Batch waiting time:
  - `W_batch = label_time – ready`

**Impact metrics**
- **Average / P95 batch waiting time** by region, by time-of-day, and peak season vs normal.
- **Batch size distribution** and **batch formation interval** (time between first-ready and last-ready within batch).
- **Hold-back effect**: fraction of orders whose end-to-end SLA miss is attributable to `W_batch` (see “attribution” below).

---

### C. Priority order handling (Express preemption / expedite)
**Goal:** quantify the delay imposed on standard orders due to express prioritization, and whether preemption is happening (or should).

**How to identify with the event log**
- Use **Order Type** (Express vs Standard).
- Detect **priority-induced displacement** around shared resources:
  - At each packing station/resource pool, build the queue timeline:
    - when a standard order is waiting and an express order arrives and starts earlier than expected, or
    - a standard order’s waiting time increases when express arrival rate spikes.
- If the system truly pauses an in-progress standard order, you need logs indicating **suspend/resume** or split packing intervals. If not present, treat it as **non-preemptive priority** (express jumps the queue) and quantify effect accordingly.

**Impact metrics**
- **Delay to Standard due to Express** (counterfactual-style):
  - Compare standard orders’ queue time in windows with high express load vs low express load, controlling for volume (or via regression).
- **Express advantage**:
  - Difference in median/P95 lead time between express and standard at each step.
- **Queue discipline indicators**:
  - “Overtake count”: number of times an express case starts Packing while earlier-arrived standard cases are still waiting (requires arrival-to-queue timestamp, typically picking complete).

---

### D. Regulatory compliance: 10 hazardous orders simultaneously in Packing or Quality Check
**Goal:** quantify how often the cap becomes binding, and how much delay it causes.

**How to identify with the event log**
- Use attribute **Hazardous Material**.
- Create a **global concurrency measure** for hazardous orders in the regulated activities:
  - Build intervals for each hazardous case in Packing and QC.
  - Compute at each timestamp the count of hazardous cases simultaneously in {Packing, QC}.
- Identify “binding periods”:
  - Times where concurrency = 10 and additional hazardous orders are waiting to start Packing/QC.

**Impact metrics**
- **Time-at-cap**: proportion of operational time where hazardous concurrency is 10.
- **Hazardous queue time** into Packing and into QC:
  - `Q_haz_pack = start(Packing) – complete(Picking)` (haz orders)
  - `Q_haz_qc = start(QC) – complete(Packing)` (haz orders)
- **Throughput reduction** for haz orders:
  - Completed haz orders/hour during cap-binding vs non-binding periods.
- **Compliance**:
  - Any observed concurrency > 10 indicates a control failure (or logging inconsistency).

---

### E. Differentiating within-instance vs between-instance waiting (root-cause attribution)
You want to separate:
- **Within-instance**: long activity duration (packing takes longer because the order is complex)
- **Between-instance**: time spent waiting because a resource/batch/regulatory slot is unavailable

**Method**
1. **Decompose per step** using start/complete:
   - Waiting before activity = `start(activity) – complete(previous activity)`  candidate between-instance waiting.
   - Execution time = `complete(activity) – start(activity)`  within-instance processing time.
2. **Explain waiting with constraint signals**:
   - Resource contention: waiting correlates with high utilization or all cold stations busy.
   - Batch constraint: waiting occurs only before Shipping Label Gen and correlates with batch formation window/region.
   - Regulatory cap: waiting occurs when haz concurrency at cap.
   - Priority: waiting for standard increases when express arrivals to the same resource pool occur.
3. **Statistical / causal modeling (practical approach)**
   - Fit a model for waiting time at each step (e.g., generalized linear model / gradient boosted trees) with predictors:
     - utilization at arrival time, queue length proxy, “all cold busy” flag, haz concurrency, express-arrival intensity, region batching indicators, time-of-day.
   - Attribute waiting time contributions per constraint via SHAP/feature importance or controlled comparisons.

---

## 2) Analyzing constraint interactions (why single-constraint fixes often fail)

Key interactions to test explicitly:

1. **Express + Cold-Packing contention**
- If express orders disproportionately require cold-packing, priority handling can:
  - reduce express lead time, but
  - dramatically increase standard cold-order waiting (and possibly increase product spoilage risk if cold chain timing is tight).
- Analysis: build a heatmap of cold-station queue time vs express arrival rate and cold-order mix.

2. **Batching + Hazardous cap**
- If a region often has many hazardous orders, batching can synchronize demand:
  - many hazardous orders become “ready” together, then all try to enter Packing/QC, hitting the cap.
  - or hazardous orders complete QC but wait in a “post-QC holding pattern” for a batch, creating congestion upstream if space/resources are shared.
- Analysis: correlate batch sizes (by region) with hazardous concurrency at Packing/QC and with haz queue time.

3. **Batching + Express**
- If batching is applied uniformly, it can negate express benefits (express completes QC quickly but still waits for batch).
- Analysis: measure `W_batch` for express vs standard; if similar, batching is undermining priority.

4. **Cold-Packing + Hazardous**
- Some hazardous orders may also require cold packing (or have specialized packing needs). This creates *compound scarcity*:
  - limited cold stations plus a global hazardous cap can produce nonlinear delays.
- Analysis: segment orders into (cold, haz) combinations and compare queue patterns and SLA misses.

Understanding interactions matters because improvements must preserve overall flow: e.g., “increase batching efficiency” can worsen SLA if it increases waiting; “expedite express” can blow up standard backlog unless capacity or rules are adjusted.

---

## 3) Constraint-aware optimization strategies (concrete proposals)

### Strategy 1: Constraint-aware dispatching for Packing (priority + cold capacity + haz cap)
**Primarily addresses:** Shared Cold-Packing, Priority handling, Hazardous cap (interaction-aware)

**Change proposed**
- Replace ad-hoc/implicit rules with a **formal dispatching policy** at Packing:
  - Two-tier priority: Express first, then Standard.
  - Within each tier, use **Earliest Due Date / SLA-risk score** and **setup compatibility** (cold vs non-cold).
  - Add **hazardous admission control**: only release a hazardous order into Packing/QC if global haz-in-Packing-or-QC < 10.
- If preemption is operationally costly, implement **non-preemptive priority** (express jumps queue but does not interrupt in-progress packing). If preemption exists, enforce rules to limit churn (e.g., only preempt if remaining time on current job > X minutes).

**How it leverages data**
- Use historical logs to train an **SLA miss risk predictor** (features: order type, cold requirement, region, time-in-process so far, current WIP, station utilization).
- Real-time decisioning uses current WIP measures derived from the same event structure.

**Expected outcomes**
- Reduced P95 lead time for Express without uncontrolled harm to Standard.
- Lower volatility in cold station queues by preventing “wrong” job mixes during saturation.
- Better compliance reliability by treating the haz cap as a first-class gating constraint rather than a downstream scramble.

---

### Strategy 2: Dynamic batching for Shipping Label Generation (region-based, SLA-aware)
**Primarily addresses:** Shipping batching delays (and its interaction with Express)

**Change proposed**
- Convert fixed/slow batching into **dynamic batch triggers** per region:
  - Trigger label generation when **either**:
    1) batch reaches size N, **or**
    2) oldest order in “ready-for-label” exceeds time threshold T (max-wait), **or**
    3) an express order is ready (express bypass or micro-batch).
- Introduce **express carve-out**:
  - express orders generate labels immediately (or in very small batches) to preserve the premium SLA.
- Optionally: region sub-clustering during peak (e.g., split “North” into North-East/North-West) to avoid large batches causing long tail waits.

**How it leverages data**
- Use logs to estimate:
  - arrival rate of “ready” orders by region and time-of-day,
  - relationship between batch size and downstream shipping efficiency (if available),
  - SLA penalty cost of waiting.
- Optimize N and T by simulation/what-if to balance route efficiency vs lead-time.

**Expected outcomes**
- Significant reduction in `W_batch` (especially P95).
- Improved express performance (batching no longer cancels priority gains).
- More stable end-to-end lead time during peak, with controllable trade-off against shipping consolidation.

---

### Strategy 3: Peak-time capacity shaping for Cold-Packing and QC (targeted, data-driven)
**Primarily addresses:** Cold-Packing bottleneck and downstream knock-on effects (incl. express)

**Change proposed**
- Add *targeted* capacity where it is truly binding:
  - Cross-train and schedule additional staff to open **overflow cold-packing capability** during predicted peak windows (even +1 station equivalent can have outsized effect if utilization is near 100%).
  - Align QC staffing to cold/express waves to avoid pushing the bottleneck downstream.
- Introduce **WIP caps** upstream to avoid flooding cold queue:
  - If cold stations saturated, throttle release of new cold picks (or sequence picking so cold items are picked closer to packing availability—reduces idle cold waiting).

**How it leverages data**
- From logs, build:
  - time-of-day/week seasonality of cold demand and station saturation,
  - queueing curves (waiting time vs utilization) to identify when small capacity increases pay off.
- Forecast next-day/hour cold demand and schedule flex resources accordingly.

**Expected outcomes**
- Lower cold-packing queue time and fewer extreme delays (P95/P99).
- Better utilization balance across picking  packing  QC (less “work completes then waits”).
- Reduced SLA misses during peak with minimal permanent headcount increase (capacity only when needed).

---

### Strategy 4 (optional but often high ROI): Hazardous “slot scheduling” across Packing and QC
**Primarily addresses:** Hazardous cap and its interaction with batching/regions

**Change proposed**
- Treat hazardous processing as a **global constrained pool**:
  - Maintain a visible “hazard slots” schedule (10 concurrent max across Packing+QC).
  - Sequence hazardous cases to smooth concurrency (avoid releasing many hazardous orders at once, especially from the same region if batching amplifies it).
- If operationally feasible: dedicate **specific QC staff or time windows** for hazardous to reduce variability and prevent cap thrashing.

**How it leverages data**
- Identify times when hazardous concurrency hits 10 and what upstream patterns cause it (e.g., large waves from certain pick zones or batch-ready synchronization).
- Use this to tune release rules (cadence-based release, not bursty release).

**Expected outcomes**
- Reduced hazardous queue times without breaking compliance.
- Less spillover delay onto non-hazardous work (because the system avoids gridlock periods).

---

## 4) Simulation and validation (before implementation)

Use a **data-driven discrete-event simulation (DES)** or **digital twin** calibrated from the event log.

**What to include in the simulation model**
- **Case arrival process**: order arrivals by time-of-day/day-of-week; mix of Express/Standard, Cold, Hazardous, Region.
- **Activity time distributions**: Picking, Packing, QC (separate distributions by order attributes, e.g., cold/haz may take longer).
- **Resource pools and calendars**
  - Standard packing stations, cold-packing stations (capacity=5), QC staff.
  - Shift patterns, breaks, downtime if present.
- **Queue disciplines**
  - Baseline FIFO vs proposed priority dispatching.
  - Preemption logic (if allowed) with realistic interruption costs.
- **Batching logic**
  - Region-based batching with current rule vs dynamic triggers (N/T/express-bypass).
- **Global hazardous concurrency constraint**
  - Hard cap: at most 10 hazardous orders simultaneously in Packing or QC.
  - Enforce as a gating rule (orders wait in a “pre-pack” or “pre-QC” queue).

**Validation approach**
- Calibrate to reproduce baseline KPIs from the log:
  - end-to-end lead time distribution, step waiting times, station utilization, batch wait, SLA miss rate.
- Then run what-if experiments:
  - Strategy 1 only, Strategy 2 only, Strategy 3 only, and combinations (because interactions matter).
- Evaluate under peak scenarios (stress tests) using highest observed arrival rates and adverse mixes (high cold + high express + high hazardous).

**KPIs to compare in simulation**
- SLA hit rate by order type.
- Mean/P95 lead time overall and by segment (cold, haz, express, region).
- Queue times at Packing (cold/non-cold), QC, and pre-label.
- Time-at-cap for hazardous constraint and any violations (should be 0).
- Utilization and starvation indicators (e.g., standard orders’ max waiting time).

---

## 5) Monitoring post-implementation (process mining dashboards & control metrics)

Set up continuous conformance + performance monitoring with near-real-time event ingestion (or daily refresh).

### Core dashboards (constraint-specific)
1. **Cold-Packing contention dashboard**
- Cold station utilization (per station and pooled).
- Queue time to Packing for cold orders (mean/median/P95) and queue length proxy (WIP waiting for cold).
- Saturation periods: % time all cold stations busy.
- SLA miss attribution for cold orders (how much time spent waiting vs processing).

2. **Batching performance dashboard**
- Batch waiting time `W_batch` by region and order type (express vs standard).
- Batch size distribution and “max wait” breaches (orders waiting > T).
- Orders ready-for-label count over time (backlog chart).

3. **Priority handling dashboard**
- Express lead time and step waiting times (Packing/QC) vs standard.
- Standard delay indicators during express spikes:
  - standard P95 wait at Packing,
  - overtake counts (express jumping ahead),
  - fairness guardrails (e.g., maximum standard wait threshold).

4. **Hazardous compliance + flow dashboard**
- Real-time hazardous concurrency in Packing+QC (must stay 10).
- Time-at-cap and hazardous queue times (to Packing and QC).
- Segment performance: hazardous vs non-hazardous lead time and SLA.

### Cross-cutting operational KPIs
- End-to-end throughput (orders/hour, orders/day).
- Lead time distribution (not just average: P90/P95/P99).
- WIP levels between each step (picked-not-packed, packed-not-QC, QC-done-waiting-label).
- Resource productivity: effective utilization vs idle vs blocked time.

### How to track “managed more effectively”
- **Before/after control charts** for:
  - cold queue P95, batch wait P95, standard wait during express spikes, hazardous time-at-cap.
- **Conformance checks**:
  - hazardous concurrency violations (should be zero),
  - express bypass rule respected (if implemented),
  - batching max-wait threshold met (e.g.,  95% within T).
- **Attribution trend**:
  - proportion of lead time due to between-instance waiting (resource/batch/cap) should decrease even if activity durations stay similar.

---

If you share the actual log schema (CSV/XES), I can outline the exact extraction queries (e.g., SQL/Python) for the waiting-time decomposition, cold-station saturation detection, and hazardous concurrency computation, and map them to specific dashboards in tools like Celonis/PM4Py/Disco.