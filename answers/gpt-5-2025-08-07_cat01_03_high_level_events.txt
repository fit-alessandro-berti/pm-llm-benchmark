Proposed high-level stages (with rationale and naming)
1) Material Preparation and Conditioning
- What it includes: Retrieve raw metal sheet, Scan barcode, Place metal sheet on table, Align metal sheet, Preheat metal sheet.
- Why grouped: These actions transform a raw part into a ready-to-process workpiece. They are temporally contiguous, executed by “material handling” resources (operator, robot, heater), and logically finish when the part is positioned and thermally conditioned for welding.

2) Welding Setup and Execution
- What it includes: Pick up welding tool, Weld corner A, Weld corner B (and additional weld points if present).
- Why grouped: Tool pickup and subsequent welds form a cohesive assembly operation performed by the same resource type (welding operator/station) and produce the joint(s).

3) In-line Weld Quality Verification
- What it includes: Measure weld integrity (and similar immediate sensor checks).
- Why grouped: Sensor-driven verification focusing on quality of the just-completed welds; temporally proximate and quality-oriented.

4) Protective Coating and Cure
- What it includes: Apply protective coating, Dry coating (and other curing/setting actions).
- Why grouped: Surface finishing operations occur after structural assembly and before final acceptance; same surface-finishing intent with coating equipment and heaters.

5) Final Visual Quality Assurance
- What it includes: Visual check (and any final sign-off).
- Why grouped: Human-centric acceptance gate after all fabrication and finishing steps.

Event-to-stage mapping rules (apply to full log)
- Stage 1: Material Preparation and Conditioning
  - Activity keywords: retrieve/pick raw material, scan barcode, place on table/fixture, align, clamp, preheat.
  - Resources: operators, robot arms, material handling stations, heating units used for preheat.
  - End trigger: first welding-related activity or a long idle gap followed by non-prep activity.

- Stage 2: Welding Setup and Execution
  - Activity keywords: pick up welding tool/torch, weld*, tack*, solder*, braze*.
  - Resources: welding operators/stations.
  - End trigger: first quality measurement event or first non-welding surface-finishing activity.

- Stage 3: In-line Weld Quality Verification
  - Activity keywords: measure weld integrity, NDT, ultrasound, continuity check, sensor QC on welds.
  - Resources: quality sensors, inspection stations.
  - End trigger: next non-QC activity (e.g., coating) or another QC loop if rework occurs.

- Stage 4: Protective Coating and Cure
  - Activity keywords: apply coat/paint/seal, spray, dip, cure, bake, dry.
  - Resources: coating units, ovens/heating units for cure.
  - End trigger: next inspection step or subsequent process stage.

- Stage 5: Final Visual Quality Assurance
  - Activity keywords: visual check/inspection, final QA, sign-off.
  - Resources: QA operators/inspectors.
  - End trigger: case completion or packaging (if present elsewhere in the full log).

Temporal merging and boundaries
- Partition by CaseID, sort by Timestamp.
- Map each low-level event to a stage using the rules above.
- Merge consecutive events mapped to the same stage into a single high-level step.
- StartTime = first event’s timestamp in the merged block; EndTime = last event’s timestamp in the block.
- If two blocks of the same stage are separated by a short gap (e.g., less than 2 minutes) and no intervening different-stage event, treat as one stage; otherwise, create a new occurrence (useful for rework loops).
- If an expected event is missing (e.g., scan), the stage still forms from the available prep events.

Structured aggregation example (cases A1 and B2)
- Schema per case:
  - CaseID
  - HighLevelSteps: ordered list of steps, each with:
    - Name
    - StartTime, EndTime, DurationSeconds
    - IncludedLowLevelActivities: [Activity strings in order]
    - ResourcesInvolved: unique set
    - KeyParameters: extracted from AdditionalInfo (summarized)

Case A1
{
  "CaseID": "A1",
  "HighLevelSteps": [
    {
      "Name": "Material Preparation and Conditioning",
      "StartTime": "2024-03-01 08:00:05",
      "EndTime": "2024-03-01 08:00:20",
      "DurationSeconds": 15,
      "IncludedLowLevelActivities": [
        "Retrieve raw metal sheet",
        "Scan barcode",
        "Place metal sheet on table",
        "Align metal sheet",
        "Preheat metal sheet"
      ],
      "ResourcesInvolved": ["Operator A", "Robot Arm #2", "Heating Unit #1"],
      "KeyParameters": {
        "PartID": "M-045",
        "Barcode": "12345",
        "TableID": "T-3",
        "Alignment": "Perfect",
        "PreheatTemperatureC": 200
      }
    },
    {
      "Name": "Welding Setup and Execution",
      "StartTime": "2024-03-01 08:01:00",
      "EndTime": "2024-03-01 08:01:10",
      "DurationSeconds": 10,
      "IncludedLowLevelActivities": [
        "Pick up welding tool",
        "Weld corner A",
        "Weld corner B"
      ],
      "ResourcesInvolved": ["Operator B"],
      "KeyParameters": {
        "ToolID": "W-12",
        "Welds": [
          {"Corner": "A", "Type": "Spot"},
          {"Corner": "B", "Type": "Spot"}
        ]
      }
    },
    {
      "Name": "In-line Weld Quality Verification",
      "StartTime": "2024-03-01 08:01:20",
      "EndTime": "2024-03-01 08:01:20",
      "DurationSeconds": 0,
      "IncludedLowLevelActivities": [
        "Measure weld integrity"
      ],
      "ResourcesInvolved": ["Quality Sensor #1"],
      "KeyParameters": {"IntegrityScore": 95}
    },
    {
      "Name": "Protective Coating and Cure",
      "StartTime": "2024-03-01 08:01:30",
      "EndTime": "2024-03-01 08:01:45",
      "DurationSeconds": 15,
      "IncludedLowLevelActivities": [
        "Apply protective coating",
        "Dry coating"
      ],
      "ResourcesInvolved": ["Coating Unit #3", "Heating Unit #2"],
      "KeyParameters": {
        "CoatingType": "Polyurethane",
        "DryTemperatureC": 120
      }
    },
    {
      "Name": "Final Visual Quality Assurance",
      "StartTime": "2024-03-01 08:02:00",
      "EndTime": "2024-03-01 08:02:00",
      "DurationSeconds": 0,
      "IncludedLowLevelActivities": [
        "Visual check"
      ],
      "ResourcesInvolved": ["Operator C"],
      "KeyParameters": {"Check": "Passed"}
    }
  ]
}

Case B2
{
  "CaseID": "B2",
  "HighLevelSteps": [
    {
      "Name": "Material Preparation and Conditioning",
      "StartTime": "2024-03-01 08:00:05",
      "EndTime": "2024-03-01 08:00:25",
      "DurationSeconds": 20,
      "IncludedLowLevelActivities": [
        "Retrieve raw metal sheet",
        "Scan barcode",
        "Place metal sheet on table",
        "Align metal sheet",
        "Preheat metal sheet"
      ],
      "ResourcesInvolved": ["Operator A", "Robot Arm #2", "Heating Unit #1"],
      "KeyParameters": {
        "PartID": "M-046",
        "Barcode": "12346",
        "TableID": "T-3",
        "Alignment": "Perfect",
        "PreheatTemperatureC": 200
      }
    },
    {
      "Name": "Welding Setup and Execution",
      "StartTime": "2024-03-01 08:01:03",
      "EndTime": "2024-03-01 08:01:12",
      "DurationSeconds": 9,
      "IncludedLowLevelActivities": [
        "Pick up welding tool",
        "Weld corner A",
        "Weld corner B"
      ],
      "ResourcesInvolved": ["Operator B"],
      "KeyParameters": {
        "ToolID": "W-12",
        "Welds": [
          {"Corner": "A", "Type": "Spot"},
          {"Corner": "B", "Type": "Spot"}
        ]
      }
    },
    {
      "Name": "In-line Weld Quality Verification",
      "StartTime": "2024-03-01 08:01:22",
      "EndTime": "2024-03-01 08:01:22",
      "DurationSeconds": 0,
      "IncludedLowLevelActivities": [
        "Measure weld integrity"
      ],
      "ResourcesInvolved": ["Quality Sensor #1"],
      "KeyParameters": {"IntegrityScore": 93}
    },
    {
      "Name": "Protective Coating and Cure",
      "StartTime": "2024-03-01 08:01:35",
      "EndTime": "2024-03-01 08:01:50",
      "DurationSeconds": 15,
      "IncludedLowLevelActivities": [
        "Apply protective coating",
        "Dry coating"
      ],
      "ResourcesInvolved": ["Coating Unit #3", "Heating Unit #2"],
      "KeyParameters": {
        "CoatingType": "Polyurethane",
        "DryTemperatureC": 120
      }
    },
    {
      "Name": "Final Visual Quality Assurance",
      "StartTime": "2024-03-01 08:02:05",
      "EndTime": "2024-03-01 08:02:05",
      "DurationSeconds": 0,
      "IncludedLowLevelActivities": [
        "Visual check"
      ],
      "ResourcesInvolved": ["Operator C"],
      "KeyParameters": {"Check": "Passed"}
    }
  ]
}

How to apply this to the full log (concise algorithm)
- Step 1: For each CaseID, sort events by Timestamp.
- Step 2: Map each event to a stage using the keyword/resource rules.
- Step 3: Sweep through events, merging adjacent events with the same mapped stage into a single high-level step. Record StartTime and EndTime from first/last events in that block.
- Step 4: Aggregate metadata for each step:
  - ResourcesInvolved = unique Resource set from the block.
  - KeyParameters = extract salient fields from AdditionalInfo (e.g., temperatures, integrity scores, tool IDs).
- Step 5: Handle loops/rework:
  - If a quality measurement fails (e.g., IntegrityScore below threshold) and more welding occurs after, create a new “Welding Setup and Execution” block followed by another “In-line Weld Quality Verification” block.
- Step 6: Export per-case HighLevelSteps in the structured format above.

Notes and edge cases
- Missing or out-of-order events: rely on stage keyword mapping first; use time gaps (>2–5 minutes) to split ambiguous long blocks.
- Parallelism: if two resources log interleaved events for the same stage, they remain in one block as long as mapping is the same; otherwise, split.
- Extensibility: add stages like “Material Kitting,” “Machining,” or “Packaging” by extending the keyword map and boundaries similarly.

This approach converts granular logs into a concise, domain-meaningful process flow while preserving traceability to the original low-level events.