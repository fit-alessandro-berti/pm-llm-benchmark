# BPMN-like Textual Process Model: Invoice Approval Process

## Overview
This model consolidates accounts from Accounts Payable Clerk (Mary), Purchasing Officer (Dan), Department Manager (Carlos), Accounts Payable Supervisor (Rita), and Supplier Relationship Manager (Karen). It captures the **standard 3-way match flow** (Invoice  PO  Receipt Confirmation) with **exception handling loops** and escalations. Ambiguities (e.g., exact system notifications) are noted inline.

**Pools/Lanes (Roles):**
- **Accounts Payable (AP) Clerk** (Mary): Entry point, logging, matching, scheduling.
- **Purchasing** (Dan): Receipt/PO confirmation.
- **Department Manager** (Carlos): Final approval.
- **AP Supervisor** (Rita): Escalations, non-PO resolutions.
- **Supplier Relationship Manager** (Karen): Supplier coordination (ad-hoc).

**Key Artifacts:**
- **Input:** Invoice (email), Purchase Order (PO).
- **Data Objects:** Logged Invoice (in accounting system), Confirmation Email, Matched Invoice Report, Approved Invoice.
- **Output:** Scheduled Payment.

## Process Flow (Textual BPMN Representation)
```
[Start Event: Invoice Received (email)]  -->  [Pool: AP Clerk]

Sequence Flow: Normal Flow (with gateways and loops)

1. Task: Check for Valid PO Number  (AP Clerk)
   - Input: Invoice
   - Output: Valid/Invalid PO Flag
   
   Gateway (Exclusive - XOR): PO Present?
    YES --> Task: Log Invoice into Accounting System  (AP Clerk)
             Output: Logged Invoice
             --> Task: Forward to Purchasing for Receipt Confirmation  (AP Clerk)
                        Output: Notification/Email to Purchasing
                        --> [Sub-Flow: Matching & Confirmation]
   
    NO --> Task: Send Back to Supplier for PO Details  (AP Clerk)
              Output: Request Email to Supplier
              Loopback --> [Possibly involves Karen] --> Task: Check for Valid PO Number  (AP Clerk)
                             (Note: May loop multiple times until PO provided)

[Sub-Flow: Matching & Confirmation]
   Task: Confirm Receipt of Goods & Match Invoice to PO  (Purchasing)
   - Input: Logged Invoice, PO
   - Output: Confirmation Email to AP
   
   Gateway (Exclusive - XOR): Matches Correctly? (Quantities, Prices, Items)
    YES --> Sequence Flow to Manager Approval
   
    NO (Discrepancy) --> Task: Contact Supplier or Request Correction  (Purchasing / AP Clerk)
                            Output: Clarification Request (may involve Karen for contract check)
                            Gateway (Exclusive - XOR): Resolved Easily?
                             YES --> Loopback to Task: Confirm Receipt & Match  (Purchasing)
                             NO --> Task: Escalate to AP Supervisor  (AP Clerk)
                                       --> [Exception Sub-Flow]
   
    MISSING PO / Non-PO Invoice --> Task: Request PO Info  (Purchasing to AP)
                                      Loopback to PO Check or --> [Exception Sub-Flow]

[Exception Sub-Flow]  (Parallel to main flow for escalations)
   Task: Handle Exception  (AP Supervisor)
   - Activities: Coordinate with departments/suppliers; create retrospective PO; involve Karen for supplier contact/contract verification; decide reject/hold.
   - Input: Escalated Invoice
   - Gateway (Exclusive - XOR): Exception Resolved?
      YES --> Merge back to main flow at "Forward to Purchasing" or "Manager Approval"
      NO --> Task: Reject Invoice  (AP Supervisor)
                    --> [End Event: Invoice Rejected]

Main Flow Continues:
   Gateway (Exclusive - XOR): Manager Approval Triggered?  (System auto-email after match + confirmation)
   Task: Review & Approve Invoice  (Department Manager)
   - Input: Invoice details, PO, Confirmation (system view)
   - Output: Approved Invoice
   
   Gateway (Exclusive - XOR): Approved?
    YES --> Task: Schedule for Payment Run  (AP Clerk)
             Output: Payment Queue Entry
             --> [End Event: Invoice Scheduled for Payment]
   
    NO (Suspicious/Budget Issue) --> Task: Reject or Hold for Investigation  (Department Manager)
                                      Output: Rejection Note to AP
                                      --> Loopback to Task: Escalate to AP Supervisor  (or direct reject)
                                         --> [Exception Sub-Flow] or [End Event: Invoice Rejected]

[End Events]
- Invoice Scheduled for Payment (Success)
- Invoice Rejected (Failure)
```

## Gateways Summary
| Gateway | Type | Conditions | Diverging Paths |
|---------|------|------------|-----------------|
| PO Present? | XOR | PO on invoice? | Yes  Log; No  Return to Supplier |
| Matches Correctly? | XOR | Line items match PO? | Yes  Approval; No  Clarify/Escalate |
| Resolved Easily? | XOR | Quick fix possible? | Yes  Rematch; No  Escalate |
| Exception Resolved? | XOR | Can proceed? | Yes  Main Flow; No  Reject |
| Manager Approved? | XOR | Sign-off given? | Yes  Payment; No  Escalate/Reject |

## Exceptions & Variations (Noted from Interviews)
- **Rework Loops:** Discrepancy clarification (Purchasing/AP  Supplier, possibly via Karen); PO requests.
- **Escalations:** To AP Supervisor (Rita) for unresolved matches, non-PO invoices (e.g., informal services  retrospective PO).
- **Ad-hoc Involvement:** Supplier Relationship Manager (Karen) for pricing/contracts, not in core lane.
- **Uncertainties:** 
  - Exact trigger for manager notification (all agree "after match + confirmation," system auto-email per Mary).
  - Payment run details (weekly? assumed by Dan/Carlos, handled by AP).
  - Rejection frequency: Rare (Carlos: "once every couple months").
- **No Parallel Flows:** Sequential, but exceptions can pause main flow.

## Visualizable Notes
- **Primary Path:** ~70-80% cases (PO valid  match  confirm  approve  pay).
- **To Diagram:** Use BPMN 2.0 tools (e.g., Camunda Modeler, Lucidchart). Pools horizontal; gateways diamond-shaped; loops via sequence flows back to prior tasks; data objects as rectangles with dashed arrows.
- **Completeness:** Model covers all mentioned steps; no major conflicts (views align, with role-specific emphases). 

This textual model is unambiguous for direct conversion to a BPMN XML/diagram.