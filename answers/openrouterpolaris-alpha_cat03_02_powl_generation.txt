from pm4py.objects.powl.obj import StrictPartialOrder, OperatorPOWL, Transition, SilentTransition
from pm4py.objects.process_tree.obj import Operator

# 1. Basic activities (transitions)
SR = Transition(label="SR")    # Service Request verification
CS = Transition(label="CS")    # Contract Setup

DA = Transition(label="DA")    # Datacenter Allocation
ACI = Transition(label="ACI")  # Access Control Initialization

BNC = Transition(label="BNC")  # Base Network Configuration
DR = Transition(label="D&R")   # Debug & Reconfigure

CD = Transition(label="CD")    # Containerized Deployment
MD = Transition(label="MD")    # Monolithic Deployment

QA = Transition(label="QA")    # Quality Assurance
SA = Transition(label="SA")    # Security Audit

GLA = Transition(label="GLA")  # Go-Live Approval

# 2. Loop: repeated configuration until stable
#    * ( BNC, D&R )
loop_cfg = OperatorPOWL(operator=Operator.LOOP, children=[BNC, DR])

# 3. Exclusive choice for deployment method
#    X ( CD, MD )
xor_deploy = OperatorPOWL(operator=Operator.XOR, children=[CD, MD])

# 4. Partial order for tasks that can be parallel:
#    - DA and ACI in parallel after CS
#    - QA and SA in parallel after deployment
#    - GLA after QA and SA
#
# We will build the entire process as one StrictPartialOrder "root":
# Nodes:
#   SR, CS, DA, ACI, loop_cfg, xor_deploy, QA, SA, GLA

root = StrictPartialOrder(nodes=[SR, CS, DA, ACI, loop_cfg, xor_deploy, QA, SA, GLA])

# 5. Add ordering constraints

# 5.1 SR -> CS (Contract Setup after Service Request verification)
root.order.add_edge(SR, CS)

# 5.2 After CS, DA and ACI can start in parallel
root.order.add_edge(CS, DA)
root.order.add_edge(CS, ACI)

# 5.3 loop_cfg (configuration loop) starts only after both DA and ACI complete
root.order.add_edge(DA, loop_cfg)
root.order.add_edge(ACI, loop_cfg)

# 5.4 Deployment choice (CD or MD) after configuration loop
root.order.add_edge(loop_cfg, xor_deploy)

# 5.5 QA and SA after the chosen deployment is completed
root.order.add_edge(xor_deploy, QA)
root.order.add_edge(xor_deploy, SA)

# 5.6 GLA after both QA and SA (they can run in any order / concurrently)
root.order.add_edge(QA, GLA)
root.order.add_edge(SA, GLA)

# 'root' now represents the complete POWL model for the described process.