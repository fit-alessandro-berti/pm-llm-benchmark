# Updated DECLARE Model with Bias-Mitigating Constraints

Below is the updated `declare_model` dictionary with new constraints designed to limit bias in the loan application process:

```python
declare_model = {
    "existence": {
        "StartApplication": {"support": 1.0, "confidence": 1.0},
        "FinalDecision": {"support": 1.0, "confidence": 1.0},
        # NEW: Ensure bias mitigation check exists in every process instance
        "BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}
    },
    "absence": {},
    "exactly_one": {},
    "init": {
        "StartApplication": {"support": 1.0, "confidence": 1.0}
    },
    "responded_existence": {
        # NEW: If sensitive attribute is checked, a manual review must occur somewhere in the trace
        "CheckApplicantRace": {"ManualReview": {"support": 1.0, "confidence": 1.0}},
        "CheckApplicantGender": {"ManualReview": {"support": 1.0, "confidence": 1.0}},
        "CheckApplicantAge": {"ManualReview": {"support": 1.0, "confidence": 1.0}}
    },
    "coexistence": {
        "StartApplication": {"FinalDecision": {"support": 1.0, "confidence": 1.0}},
        # NEW: Decisions involving minority applicants must coexist with ManualReview
        "Approve_Minority": {"ManualReview": {"support": 1.0, "confidence": 1.0}},
        "Reject_Minority": {"ManualReview": {"support": 1.0, "confidence": 1.0}},
        # NEW: Ensure BiasMitigationCheck coexists with any final decision
        "FinalDecision": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}}
    },
    "response": {
        "StartApplication": {"RequestAdditionalInfo": {"support": 1.0, "confidence": 1.0}},
        # NEW: After checking sensitive attributes, a BiasMitigationCheck must eventually follow
        "CheckApplicantRace": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}},
        "CheckApplicantGender": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}},
        "CheckApplicantAge": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}}
    },
    "precedence": {
        # NEW: BiasMitigationCheck must precede any Reject decision
        "Reject": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}},
        # NEW: ManualReview must precede decisions for sensitive demographics
        "Reject_Minority": {"ManualReview": {"support": 1.0, "confidence": 1.0}},
        "Approve_Minority": {"ManualReview": {"support": 1.0, "confidence": 1.0}}
    },
    "succession": {
        "RequestAdditionalInfo": {"FinalDecision": {"support": 1.0, "confidence": 1.0}},
        # NEW: BiasMitigationCheck must be followed by FinalDecision (and must have preceded it)
        "BiasMitigationCheck": {"FinalDecision": {"support": 1.0, "confidence": 1.0}}
    },
    "altresponse": {},
    "altprecedence": {},
    "altsuccession": {},
    "chainresponse": {
        # NEW: ManualReview must be immediately followed by BiasMitigationCheck
        "ManualReview": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}}
    },
    "chainprecedence": {
        # NEW: FinalDecision must be immediately preceded by BiasMitigationCheck
        "FinalDecision": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}}
    },
    "chainsuccession": {},
    "noncoexistence": {
        # NEW: Direct rejection without any review cannot coexist with sensitive attribute checks
        "DirectReject": {"CheckApplicantRace": {"support": 1.0, "confidence": 1.0}}
    },
    "nonsuccession": {
        # NEW: CheckApplicantRace cannot be eventually followed by Reject without intermediate steps
        "CheckApplicantRace": {"Reject": {"support": 1.0, "confidence": 1.0}},
        "CheckApplicantGender": {"Reject": {"support": 1.0, "confidence": 1.0}},
        "CheckApplicantAge": {"Reject": {"support": 1.0, "confidence": 1.0}}
    },
    "nonchainsuccession": {
        # NEW: Sensitive attribute checks cannot be immediately followed by decision activities
        "CheckApplicantRace": {"Approve": {"support": 1.0, "confidence": 1.0}},
        "CheckApplicantRace": {"Reject": {"support": 1.0, "confidence": 1.0}},
        "CheckApplicantGender": {"Approve": {"support": 1.0, "confidence": 1.0}},
        "CheckApplicantGender": {"Reject": {"support": 1.0, "confidence": 1.0}},
        "CheckApplicantAge": {"Approve": {"support": 1.0, "confidence": 1.0}},
        "CheckApplicantAge": {"Reject": {"support": 1.0, "confidence": 1.0}}
    }
}
```

---

## Rationale for Added Constraints

### 1. **Existence Constraint: `BiasMitigationCheck`**
```python
"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}
```
**Purpose:** Ensures that every loan application process instance includes a bias mitigation check, making fairness verification a mandatory step in the workflow.

---

### 2. **Responded Existence Constraints: Sensitive Attribute  ManualReview**
```python
"CheckApplicantRace": {"ManualReview": {"support": 1.0, "confidence": 1.0}}
"CheckApplicantGender": {"ManualReview": {"support": 1.0, "confidence": 1.0}}
"CheckApplicantAge": {"ManualReview": {"support": 1.0, "confidence": 1.0}}
```
**Purpose:** If any sensitive attribute is checked (race, gender, or age), a `ManualReview` must occur somewhere in the trace. This ensures human oversight when sensitive data is accessed.

---

### 3. **Coexistence Constraints: Sensitive Decisions  ManualReview**
```python
"Approve_Minority": {"ManualReview": {"support": 1.0, "confidence": 1.0}}
"Reject_Minority": {"ManualReview": {"support": 1.0, "confidence": 1.0}}
"FinalDecision": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}}
```
**Purpose:** Decisions involving applicants from sensitive demographics (minority groups) must always coexist with a `ManualReview`. Additionally, any `FinalDecision` must coexist with a `BiasMitigationCheck`, ensuring no decision is made without fairness verification.

---

### 4. **Response Constraints: Sensitive Attribute Check  BiasMitigationCheck**
```python
"CheckApplicantRace": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}}
"CheckApplicantGender": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}}
"CheckApplicantAge": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}}
```
**Purpose:** After checking any sensitive attribute, the process must eventually perform a `BiasMitigationCheck`. This creates a mandatory fairness checkpoint after accessing potentially bias-inducing information.

---

### 5. **Precedence Constraints: BiasMitigationCheck/ManualReview Before Decisions**
```python
"Reject": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}}
"Reject_Minority": {"ManualReview": {"support": 1.0, "confidence": 1.0}}
"Approve_Minority": {"ManualReview": {"support": 1.0, "confidence": 1.0}}
```
**Purpose:** A `BiasMitigationCheck` must occur before any `Reject` decision. For decisions involving minority applicants, a `ManualReview` must precede the decision. This prevents hasty rejections based on sensitive attributes.

---

### 6. **Succession Constraint: BiasMitigationCheck  FinalDecision**
```python
"BiasMitigationCheck": {"FinalDecision": {"support": 1.0, "confidence": 1.0}}
```
**Purpose:** Establishes a bidirectional relationship where `BiasMitigationCheck` must be followed by `FinalDecision`, and `FinalDecision` must be preceded by `BiasMitigationCheck`. This ensures the fairness check is tightly coupled with the decision-making step.

---

### 7. **Chain Response: ManualReview  BiasMitigationCheck (Immediate)**
```python
"ManualReview": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}}
```
**Purpose:** After a `ManualReview`, the next activity must be a `BiasMitigationCheck`. This creates a strict sequence ensuring that manual reviews are immediately validated for bias.

---

### 8. **Chain Precedence: BiasMitigationCheck  FinalDecision (Immediate)**
```python
"FinalDecision": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}}
```
**Purpose:** The activity immediately before `FinalDecision` must be `BiasMitigationCheck`. This ensures no other activities can intervene between the bias check and the final decision.

---

### 9. **Non-Succession Constraints: Sensitive Attribute  Reject**
```python
"CheckApplicantRace": {"Reject": {"support": 1.0, "confidence": 1.0}}
"CheckApplicantGender": {"Reject": {"support": 1.0, "confidence": 1.0}}
"CheckApplicantAge": {"Reject": {"support": 1.0, "confidence": 1.0}}
```
**Purpose:** Prevents any eventual succession from sensitive attribute checks to rejection decisions. This ensures that checking a sensitive attribute cannot lead to rejection without other intervening activities (like bias mitigation checks).

---

### 10. **Non-Chain-Succession Constraints: No Immediate Decision After Sensitive Check**
```python
"CheckApplicantRace": {"Approve": {"support": 1.0, "confidence": 1.0}}
"CheckApplicantRace": {"Reject": {"support": 1.0, "confidence": 1.0}}
"CheckApplicantGender": {"Approve": {"support": 1.0, "confidence": 1.0}}
"CheckApplicantGender": {"Reject": {"support": 1.0, "confidence": 1.0}}
"CheckApplicantAge": {"Approve": {"support": 1.0, "confidence": 1.0}}
"CheckApplicantAge": {"Reject": {"support": 1.0, "confidence": 1.0}}
```
**Purpose:** Prevents any decision activity (`Approve` or `Reject`) from immediately following a sensitive attribute check. This ensures that at least one other activity (such as `BiasMitigationCheck` or `ManualReview`) must occur between accessing sensitive information and making a decision.

---

## Summary of Bias Mitigation Strategy

| Constraint Type | Purpose |
|----------------|---------|
| **Existence** | Mandates fairness checkpoints in every process |
| **Responded Existence** | Links sensitive data access to human oversight |
| **Coexistence** | Ensures manual review for sensitive demographic decisions |
| **Response** | Requires bias checks after accessing sensitive attributes |
| **Precedence** | Guarantees fairness verification before rejections |
| **Succession** | Tightly couples bias checks with final decisions |
| **Chain Precedence/Response** | Enforces immediate sequencing for critical fairness steps |
| **Non-Succession** | Prevents biased pathways from attribute checks to rejections |
| **Non-Chain-Succession** | Blocks immediate decisions after sensitive attribute access |

These constraints collectively ensure that:
1. **No decision can be made without a bias check**
2. **Sensitive attribute access triggers mandatory oversight**
3. **Decisions for sensitive demographics receive additional scrutiny**
4. **Direct paths from bias-prone activities to decisions are blocked**