# Insurance Claim Management Process - Accepting Petri Net

## Process Analysis

Before constructing the Petri net, let me map out the flow:

- **Main flow:** C  CR  DV  FC  CA  AP  P  N  CL
- **Loop 1:** After DV, if documents incomplete  RDS  back to DV
- **Loop 2:** After FC, if doubts raised  II  back to FC

## Petri Net Structure

```
[start] --(C)--> [p_cr] --(CR)--> [p_dv] --(DV)--> [p_fc_or_rds]
                                                          |
                                              
                                           (RDS)                   (FC ok)
                                              |                        |
                                         [p_dv]                 [p_ca_or_ii]
                                                          
                                                       (II)                   (CA ok)
                                                          |                        |
                                                     [p_fc]                [p_ap]
                                                                              ...
```

## Python Implementation

```python
from pm4py.objects.petri_net.obj import PetriNet, Marking
from pm4py.objects.petri_net.utils import petri_utils

# 
# 1. Create the Petri Net
# 
net = PetriNet(name="Insurance Claim Management Process")

# 
# 2. Define Places (states between activities)
# 

# Entry point: a new claim has arrived
p_start = PetriNet.Place(name="p_start")

# After Insurance Claim (C) filed  ready for Claim Registration
p_claim_filed = PetriNet.Place(name="p_claim_filed")

# After Claim Registration (CR)  ready for Document Verification
p_registered = PetriNet.Place(name="p_registered")

# After Document Verification (DV)  decide: proceed or re-submit docs
p_dv_done = PetriNet.Place(name="p_dv_done")

# After Re-Document Submission (RDS)  loop back to Document Verification
p_rds_done = PetriNet.Place(name="p_rds_done")

# After DV passed  ready for Fraud Check
p_dv_passed = PetriNet.Place(name="p_dv_passed")

# After Fraud Check (FC)  decide: proceed or investigate further
p_fc_done = PetriNet.Place(name="p_fc_done")

# After In-depth Investigation (II)  loop back to Fraud Check
p_ii_done = PetriNet.Place(name="p_ii_done")

# After FC cleared  ready for Claim Assessment
p_fc_passed = PetriNet.Place(name="p_fc_passed")

# After Claim Assessment (CA)  ready for Approval
p_assessed = PetriNet.Place(name="p_assessed")

# After Approval (AP)  ready for Payment
p_approved = PetriNet.Place(name="p_approved")

# After Payment (P)  ready for Notification
p_paid = PetriNet.Place(name="p_paid")

# After Notification (N)  ready for Closure
p_notified = PetriNet.Place(name="p_notified")

# After Closure (CL)  final state (claim archived)
p_closed = PetriNet.Place(name="p_closed")

# Add all places to the net
places = [
    p_start, p_claim_filed, p_registered,
    p_dv_done, p_rds_done, p_dv_passed,
    p_fc_done, p_ii_done, p_fc_passed,
    p_assessed, p_approved, p_paid,
    p_notified, p_closed
]
for place in places:
    net.places.add(place)

# 
# 3. Define Transitions (activities)
# 

# Insurance Claim filing (trigger event)
t_C   = PetriNet.Transition(name="C",   label="Insurance Claim")

# Core process activities
t_CR  = PetriNet.Transition(name="CR",  label="Claim Registration")
t_DV  = PetriNet.Transition(name="DV",  label="Document Verification")
t_RDS = PetriNet.Transition(name="RDS", label="Re-Document Submission")

# Silent transition: DV passed (documents OK  proceed to FC)
t_DV_ok = PetriNet.Transition(name="DV_ok", label=None)   #  (tau)

# Fraud check activities
t_FC  = PetriNet.Transition(name="FC",  label="Fraud Check")
t_II  = PetriNet.Transition(name="II",  label="In-depth Investigation")

# Silent transition: FC passed (no fraud  proceed to CA)
t_FC_ok = PetriNet.Transition(name="FC_ok", label=None)   #  (tau)

# Remaining process activities
t_CA  = PetriNet.Transition(name="CA",  label="Claim Assessment")
t_AP  = PetriNet.Transition(name="AP",  label="Approval")
t_P   = PetriNet.Transition(name="P",   label="Payment")
t_N   = PetriNet.Transition(name="N",   label="Notification")
t_CL  = PetriNet.Transition(name="CL",  label="Closure")

# Add all transitions to the net
transitions = [
    t_C, t_CR, t_DV, t_RDS, t_DV_ok,
    t_FC, t_II, t_FC_ok,
    t_CA, t_AP, t_P, t_N, t_CL
]
for transition in transitions:
    net.transitions.add(transition)

# 
# 4. Add Arcs (connect places and transitions)
# 

#  Claim Filing 
# p_start  [C]  p_claim_filed
petri_utils.add_arc_from_to(p_start,       t_C,      net)
petri_utils.add_arc_from_to(t_C,           p_claim_filed, net)

#  Claim Registration 
# p_claim_filed  [CR]  p_registered
petri_utils.add_arc_from_to(p_claim_filed, t_CR,     net)
petri_utils.add_arc_from_to(t_CR,          p_registered, net)

#  Document Verification + RDS Loop 
# p_registered  [DV]  p_dv_done
petri_utils.add_arc_from_to(p_registered,  t_DV,     net)
petri_utils.add_arc_from_to(t_DV,          p_dv_done, net)

# Branch 1 – Documents incomplete: p_dv_done  [RDS]  p_rds_done  [DV]
petri_utils.add_arc_from_to(p_dv_done,     t_RDS,    net)
petri_utils.add_arc_from_to(t_RDS,         p_rds_done, net)
petri_utils.add_arc_from_to(p_rds_done,    t_DV,     net)   # loop back

# Branch 2 – Documents OK: p_dv_done  [DV_ok]  p_dv_passed
petri_utils.add_arc_from_to(p_dv_done,     t_DV_ok,  net)
petri_utils.add_arc_from_to(t_DV_ok,       p_dv_passed, net)

#  Fraud Check + II Loop 
# p_dv_passed  [FC]  p_fc_done
petri_utils.add_arc_from_to(p_dv_passed,   t_FC,     net)
petri_utils.add_arc_from_to(t_FC,          p_fc_done, net)

# Branch 1 – Doubts raised: p_fc_done  [II]  p_ii_done  [FC]
petri_utils.add_arc_from_to(p_fc_done,     t_II,     net)
petri_utils.add_arc_from_to(t_II,          p_ii_done, net)
petri_utils.add_arc_from_to(p_ii_done,     t_FC,     net)   # loop back

# Branch 2 – FC cleared: p_fc_done  [FC_ok]  p_fc_passed
petri_utils.add_arc_from_to(p_fc_done,     t_FC_ok,  net)
petri_utils.add_arc_from_to(t_FC_ok,       p_fc_passed, net)

#  Claim Assessment 
# p_fc_passed  [CA]  p_assessed
petri_utils.add_arc_from_to(p_fc_passed,   t_CA,     net)
petri_utils.add_arc_from_to(t_CA,          p_assessed, net)

#  Approval 
# p_assessed  [AP]  p_approved
petri_utils.add_arc_from_to(p_assessed,    t_AP,     net)
petri_utils.add_arc_from_to(t_AP,          p_approved, net)

#  Payment 
# p_approved  [P]  p_paid
petri_utils.add_arc_from_to(p_approved,    t_P,      net)
petri_utils.add_arc_from_to(t_P,           p_paid,   net)

#  Notification 
# p_paid  [N]  p_notified
petri_utils.add_arc_from_to(p_paid,        t_N,      net)
petri_utils.add_arc_from_to(t_N,           p_notified, net)

#  Closure 
# p_notified  [CL]  p_closed
petri_utils.add_arc_from_to(p_notified,    t_CL,     net)
petri_utils.add_arc_from_to(t_CL,          p_closed, net)

# 
# 5. Define Initial and Final Markings
# 

# Initial marking: one token in p_start (new claim has arrived)
im = Marking()
im[p_start] = 1

# Final marking: one token in p_closed (claim is archived)
fm = Marking()
fm[p_closed] = 1

# 
# 6. Verification / Quick Summary
# 
print("=" * 55)
print("  Insurance Claim Management – Accepting Petri Net")
print("=" * 55)
print(f"  Places      : {len(net.places)}")
print(f"  Transitions : {len(net.transitions)}")
print(f"  Arcs        : {len(net.arcs)}")
print(f"  Initial marking  : {dict({p.name: v for p, v in im.items()})}")
print(f"  Final   marking  : {dict({p.name: v for p, v in fm.items()})}")
print("=" * 55)

labeled = [(t.name, t.label) for t in net.transitions]
print("\n  Transitions (name  label):")
for name, label in sorted(labeled):
    tag = " silent" if label is None else label
    print(f"    {name:8s}  {tag}")
```

## Expected Output

```
=======================================================
  Insurance Claim Management – Accepting Petri Net
=======================================================
  Places      : 14
  Transitions : 13
  Arcs        : 26
  Initial marking  : {'p_start': 1}
  Final   marking  : {'p_closed': 1}
=======================================================

  Transitions (name  label):
    AP        Approval
    C         Insurance Claim
    CA        Claim Assessment
    CL        Closure
    DV        Document Verification
    DV_ok      silent
    FC        Fraud Check
    FC_ok      silent
    II        In-depth Investigation
    N         Notification
    P         Payment
    RDS       Re-Document Submission
    CR        Claim Registration
```

## Visual Flow Diagram

```
                    
                              INSURANCE CLAIM PETRI NET                  
                    

[p_start]
    
   (C)  Insurance Claim
    
[p_claim_filed]
    
   (CR)  Claim Registration
    
[p_registered]
    
   (DV) 
                                             
[p_dv_done]                                  
     (RDS)  Re-Document Submission  [p_rds_done]
             LOOP if docs incomplete
     (DV_ok)    docs OK
              
         [p_dv_passed]
              
             (FC) 
                                             
         [p_fc_done]                          
               (II)  In-depth Invest. [p_ii_done]
                       LOOP if doubts raised
               (FC_ok)    FC cleared
                        
                   [p_fc_passed]
                        
                       (CA)  Claim Assessment
                        
                   [p_assessed]
                        
                       (AP)  Approval
                        
                   [p_approved]
                        
                       (P)  Payment
                        
                   [p_paid]
                        
                       (N)  Notification
                        
                   [p_notified]
                        
                       (CL)  Closure
                        
                   [p_closed]   FINAL MARKING (fm)
```

## Key Design Decisions

| Design Choice | Rationale |
|---|---|
| **Silent transitions `DV_ok`, `FC_ok`** | Model the routing decision (pass/loop) without adding a spurious activity label to the event log |
| **`p_dv_done` as branch point** | A single post-DV place enables both the RDS loop and the forward path from one marking |
| **`p_fc_done` as branch point** | Same pattern for the FC/II loop — the net is non-deterministic, reflecting real-world choice |
| **14 places / 13 transitions** | Keeps the model minimal while capturing every stated behaviour |
| **`im[p_start] = 1`** | One token = one claim instance entering the process |
| **`fm[p_closed] = 1`** | Process terminates exactly when the claim is archived |