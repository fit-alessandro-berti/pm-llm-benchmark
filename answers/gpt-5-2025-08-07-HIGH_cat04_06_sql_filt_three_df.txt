WITH ordered AS (
  SELECT
    case_id,
    activity,
    timestamp,
    LEAD(activity, 1) OVER (PARTITION BY case_id ORDER BY timestamp) AS next_act,
    LEAD(activity, 2) OVER (PARTITION BY case_id ORDER BY timestamp) AS next2_act,
    LEAD(timestamp, 1) OVER (PARTITION BY case_id ORDER BY timestamp) AS next_ts,
    LEAD(timestamp, 2) OVER (PARTITION BY case_id ORDER BY timestamp) AS next2_ts
  FROM event_log
),
cases_to_exclude AS (
  SELECT DISTINCT case_id
  FROM ordered
  WHERE activity = 'Approve Purchase Requisition'
    AND next_act = 'Create Order'
    AND next2_act = 'Confirm Order'
    AND (next2_ts - next_ts) > INTERVAL 5 DAY
)
SELECT e.*
FROM event_log e
WHERE NOT EXISTS (
  SELECT 1
  FROM cases_to_exclude c
  WHERE c.case_id = e.case_id
)
ORDER BY e.case_id, e.timestamp;