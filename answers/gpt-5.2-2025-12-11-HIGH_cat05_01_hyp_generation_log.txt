Below is a ready-to-copy prompt you can give to a target LLM.

---

## Prompt: Order Process Event Log Anomaly Investigation (PostgreSQL)

You are a process mining and data investigation assistant. You will analyze an order-to-cash event log stored in PostgreSQL, identify anomalies/undesirable behaviors, hypothesize causes, and propose SQL queries to investigate them.

### Database Context (PostgreSQL)

#### Table: `order_event_log`
- `case_id` (INTEGER): Identifies an order instance
- `event_id` (INTEGER): Primary key for event records
- `activity` (VARCHAR): Activity name
- `timestamp` (TIMESTAMP): When the activity occurred
- `resource` (VARCHAR): Person/system performing the activity
- `additional_info` (VARCHAR): Extra details (e.g., amounts, reason codes)

#### Table: `orders`
- `case_id` (INTEGER)
- `customer_id` (INTEGER)
- `order_type` (VARCHAR) — e.g., standard, priority
- `order_value` (DECIMAL)

#### Table: `resources`
- `resource_id` (VARCHAR) — matches `order_event_log.resource`
- `role` (VARCHAR)
- `department` (VARCHAR)

### Assumed “Normal” Process Flow
1. Register Order (Sales)  
2. Perform Credit Check (Finance)  
3. Validate Stock (Warehouse)  
4. Confirm Shipment (Logistics)  
5. Ship Goods (Logistics)  
6. Issue Invoice (Finance)  
7. Receive Payment (Finance)

### Example Data (excerpt)

`order_event_log`:

case 1001:
- Register Order  Perform Credit Check  Validate Stock  Confirm Shipment  Ship Goods  Issue Invoice  Receive Payment

case 1002:
- Register Order  Confirm Shipment  Ship Goods  Perform Credit Check  Validate Stock  Issue Invoice  Receive Payment

case 1003:
- Register Order  Perform Credit Check  Ship Goods  Issue Invoice  Confirm Shipment  Receive Payment

case 1004:
- Register Order  Receive Payment  Issue Invoice  Confirm Shipment  Ship Goods

`orders`:
- 1001 standard 1250.00
- 1002 priority 2000.00
- 1003 standard 1500.00
- 1004 standard 3000.00

`resources` includes roles/departments such as Sales Executive (Sales), Credit Analyst (Finance), Accountant/Cashier/Billing Officer (Finance), Warehouse Staff (Logistics), Logistics Manager (Logistics).

---

## Your Tasks

### 1) Identify anomalies and undesirable behaviors
From the example event sequences and the assumed normal flow, list anomalies such as (but not limited to) ordering violations, missing steps, suspicious timing, duplicates, policy violations, or resource/department mismatches. Be explicit: name the anomaly pattern and describe what it looks like in the log.

### 2) Hypothesize plausible causes
For each anomaly pattern, propose multiple plausible root causes (system issues, workarounds, policy exceptions, training gaps, incorrect timestamps, automation, batch postings, fraud risk, etc.). Keep hypotheses testable.

### 3) Propose SQL queries to investigate (PostgreSQL)
Write SQL queries that could be run on these tables to validate/quantify each anomaly and test your hypotheses.

**Requirements for the SQL:**
- Use PostgreSQL syntax.
- Queries should be runnable against the described schema.
- Prefer queries that return actionable result sets (e.g., `case_id`, timestamps, detected violation type, responsible resource/department, order_value/order_type).
- Use CTEs and window functions where helpful (e.g., `row_number()`, `lag()`, `lead()`, `min()/max()` filters, conditional aggregation).
- Include queries for:
  - activity order violations (A occurs after B when it should be before)
  - missing mandatory activities per case
  - activities occurring multiple times unexpectedly
  - “impossible” or suspicious timestamp relationships (negative durations, payment before invoice, shipping before credit check, etc.)
  - resource/department compliance (e.g., finance activities executed by non-finance departments)
  - segmentation (by `order_type`, `order_value`, customer, department) to see where anomalies concentrate
- For each query: add 1–2 lines explaining what it detects and how to interpret the output.

### Output Format
Produce your answer in three sections:

1. **Anomalies Observed** (bulleted list)
2. **Hypotheses to Explain Anomalies** (mapped to anomalies)
3. **SQL Investigation Queries**  
   For each query:
   - Title
   - SQL code block
   - Brief explanation of expected results

Do not ask me follow-up questions. Make reasonable assumptions as needed, but state them briefly.