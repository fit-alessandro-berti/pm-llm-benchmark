# Insurance Claim Management — Accepting Petri Net

## Design Rationale

| Element | Purpose |
|---|---|
| **DV  RDS loop** | After `DV`, docs may be incomplete  `RDS` fires and returns the token to *before* `DV` |
| **FC  II loop** | After `FC`, fraud doubts may arise  `II` fires and returns the token to *before* `FC` |
| **AP optional path** | After `CA`, two mutually exclusive silent transitions: one through `AP`, one skipping it |
| **Silent (`label=None`) transitions** | Model XOR routing decisions without adding activity labels |

```
source [CR] p_after_cr [DV] p_after_dv
                                           
                                        [RDS] [_dv_ok]
                         
                                               
                                          p_before_fc [FC] p_after_fc
                                                                     
                                               [II]  [CA]
                                                                        
                                                                   p_after_ca
                                                                          
                                                                  [AP]  [_skip_ap]
                                                                    
                                                                  p_before_p
                                                                       
                                                              [P]p_after_p[N]p_after_n[CL]sink
```

---

```python
from pm4py.objects.petri_net.obj import PetriNet, Marking
from pm4py.objects.petri_net.utils import petri_utils

# 
# 1.  Create the Petri net
# 
net = PetriNet(name="insurance_claim_management")

# 
# 2.  Places  (represent states / conditions between activities)
# 
source      = PetriNet.Place(name="source")       # new claim arrives
p_after_cr  = PetriNet.Place(name="p_after_cr")  # after Claim Registration   before DV
p_after_dv  = PetriNet.Place(name="p_after_dv")  # after Document Verification  choice (RDS | FC)
p_before_fc = PetriNet.Place(name="p_before_fc") # docs verified OK (or II done)  ready for FC
p_after_fc  = PetriNet.Place(name="p_after_fc")  # after Fraud Check  choice (II | CA)
p_after_ca  = PetriNet.Place(name="p_after_ca")  # after Claim Assessment  choice (AP | skip AP)
p_before_p  = PetriNet.Place(name="p_before_p")  # approved (or approval skipped)  ready for Payment
p_after_p   = PetriNet.Place(name="p_after_p")   # after Payment  before Notification
p_after_n   = PetriNet.Place(name="p_after_n")   # after Notification  before Closure
sink        = PetriNet.Place(name="sink")         # claim closed & archived

for place in [source, p_after_cr, p_after_dv, p_before_fc,
              p_after_fc, p_after_ca, p_before_p,
              p_after_p, p_after_n, sink]:
    net.places.add(place)

# 
# 3.  Transitions  (visible activities + silent routing transitions)
# 
# --- Main activity transitions (visible / labelled) --------------------------
t_cr  = PetriNet.Transition(name="t_CR",  label="Claim Registration")
t_dv  = PetriNet.Transition(name="t_DV",  label="Document Verification")
t_rds = PetriNet.Transition(name="t_RDS", label="Re-Document Submission")
t_fc  = PetriNet.Transition(name="t_FC",  label="Fraud Check")
t_ii  = PetriNet.Transition(name="t_II",  label="In-depth Investigation")
t_ca  = PetriNet.Transition(name="t_CA",  label="Claim Assessment")
t_ap  = PetriNet.Transition(name="t_AP",  label="Approval")
t_p   = PetriNet.Transition(name="t_P",   label="Payment")
t_n   = PetriNet.Transition(name="t_N",   label="Notification")
t_cl  = PetriNet.Transition(name="t_CL",  label="Closure")

# --- Silent (tau) routing transitions (label=None  invisible) ---------------
# 1 : documents verified OK  proceed to Fraud Check
t_dv_ok   = PetriNet.Transition(name="tau_dv_ok",   label=None)
# 2 : amount below threshold  skip Approval, go straight to Payment
t_skip_ap = PetriNet.Transition(name="tau_skip_ap", label=None)

for trans in [t_cr, t_dv, t_rds, t_dv_ok,
              t_fc, t_ii, t_ca,
              t_ap, t_skip_ap,
              t_p, t_n, t_cl]:
    net.transitions.add(trans)

# 
# 4.  Arcs  (directed edges connecting places  transitions)
# 

#  Claim Registration 
petri_utils.add_arc_from_to(source,      t_cr,       net)
petri_utils.add_arc_from_to(t_cr,        p_after_cr, net)

#  Document Verification 
petri_utils.add_arc_from_to(p_after_cr,  t_dv,       net)
petri_utils.add_arc_from_to(t_dv,        p_after_dv, net)

#  Re-Document Submission loop 
#    p_after_dv [RDS] p_after_cr  : docs incomplete  re-submit  redo DV
petri_utils.add_arc_from_to(p_after_dv,  t_rds,      net)
petri_utils.add_arc_from_to(t_rds,       p_after_cr, net)   #  back to before DV

#  Silent: docs OK  move to Fraud Check stage 
petri_utils.add_arc_from_to(p_after_dv,  t_dv_ok,    net)
petri_utils.add_arc_from_to(t_dv_ok,     p_before_fc,net)

#  Fraud Check 
petri_utils.add_arc_from_to(p_before_fc, t_fc,       net)
petri_utils.add_arc_from_to(t_fc,        p_after_fc, net)

#  In-depth Investigation loop 
#    p_after_fc [II] p_before_fc  : doubts  investigate  redo FC
petri_utils.add_arc_from_to(p_after_fc,  t_ii,       net)
petri_utils.add_arc_from_to(t_ii,        p_before_fc,net)   #  back to before FC

#  Claim Assessment (FC cleared) 
petri_utils.add_arc_from_to(p_after_fc,  t_ca,       net)
petri_utils.add_arc_from_to(t_ca,        p_after_ca, net)

#  Approval path (amount surpasses threshold) 
petri_utils.add_arc_from_to(p_after_ca,  t_ap,       net)
petri_utils.add_arc_from_to(t_ap,        p_before_p, net)

#  Silent: skip Approval (amount below threshold) 
petri_utils.add_arc_from_to(p_after_ca,  t_skip_ap,  net)
petri_utils.add_arc_from_to(t_skip_ap,   p_before_p, net)

#  Payment 
petri_utils.add_arc_from_to(p_before_p,  t_p,        net)
petri_utils.add_arc_from_to(t_p,         p_after_p,  net)

#  Notification 
petri_utils.add_arc_from_to(p_after_p,   t_n,        net)
petri_utils.add_arc_from_to(t_n,         p_after_n,  net)

#  Closure 
petri_utils.add_arc_from_to(p_after_n,   t_cl,       net)
petri_utils.add_arc_from_to(t_cl,        sink,        net)

# 
# 5.  Initial and Final Markings
# 
im = Marking()
im[source] = 1   # one token in source  a new claim has arrived

fm = Marking()
fm[sink] = 1     # one token in sink    the claim is closed & archived
```

---

## Structural Summary

```
Place           Meaning

source          New insurance claim filed
p_after_cr      Claim registered; waiting for document verification
p_after_dv      Documents checked; waiting for routing decision
p_before_fc     Documents accepted (or re-investigation done); ready for fraud check
p_after_fc      Fraud check done; waiting for routing decision
p_after_ca      Claim assessed; waiting for approval / payment routing
p_before_p      Approved (or approval skipped); ready for payment
p_after_p       Payment issued; waiting for notification
p_after_n       Customer notified; waiting for closure
sink            Claim closed and archived   FINAL MARKING

Transition      Label / Type

t_CR            "Claim Registration"          visible
t_DV            "Document Verification"       visible
t_RDS           "Re-Document Submission"      visible  (loop  p_after_cr)
tau_dv_ok       None                          SILENT   (docs OK  p_before_fc)
t_FC            "Fraud Check"                 visible
t_II            "In-depth Investigation"      visible  (loop  p_before_fc)
t_CA            "Claim Assessment"            visible
t_AP            "Approval"                    visible
tau_skip_ap     None                          SILENT   (skip AP  p_before_p)
t_P             "Payment"                     visible
t_N             "Notification"                visible
t_CL            "Closure"                     visible
```