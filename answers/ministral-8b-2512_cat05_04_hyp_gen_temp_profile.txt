### **Anomaly Analysis & Hypotheses**

#### **1. Anomalies in Temporal Profile Model**
The following deviations from expected process timing suggest potential irregularities:

- **('R', 'P') – Receive to Approve**
  - **Avg Time:** ~25 hours (1 day)
  - **STDEV:** 1 hour (extremely low)
  - **Issue:** The tight standard deviation suggests an artificial or rigid scheduling mechanism, possibly bypassing intermediate steps (e.g., evaluation) or enforcing a strict approval window.

- **('P', 'N') – Approve to Notify**
  - **Avg Time:** 7 days
  - **STDEV:** 2 days (high)
  - **Issue:** A long average delay with high variability indicates either:
    - A backlog in notification processing.
    - Inconsistent resource allocation (e.g., some adjusters delay notifications while others do not).
    - Possible manual bottlenecks (e.g., customer communication handled by a separate team).

- **('A', 'C') – Assign to Close**
  - **Avg Time:** 2 hours
  - **STDEV:** 1 hour
  - **Issue:** Claims are closed very quickly after assignment, often skipping **Evaluate (E)** or **Approve (P)**. This suggests:
    - Premature closure (e.g., claims rejected without proper evaluation).
    - Automated flagging for trivial claims, bypassing manual review.

- **('E', 'N') – Evaluate to Notify**
  - **Avg Time:** 5 minutes
  - **STDEV:** 1 minute
  - **Issue:** The extremely short time suggests:
    - Notification is triggered immediately after evaluation, possibly skipping **Approve (P)** (e.g., auto-approval for low-risk claims).
    - A technical glitch where evaluation and notification are linked without proper review.

---

#### **2. Possible Hypotheses for Anomalies**
| **Anomaly**       | **Possible Causes**                                                                 |
|-------------------|------------------------------------------------------------------------------------|
| **('R', 'P')**    | - Claims are auto-approved after a fixed delay (e.g., 24h).<br>- Evaluation is skipped for certain claim types. |
| **('P', 'N')**    | - Notification is handled by a separate team with inconsistent workload.<br>- Some adjusters delay notifications intentionally (e.g., pending customer follow-up). |
| **('A', 'C')**    | - Claims are auto-closed if no activity occurs within a short window.<br>- Adjusters prematurely close claims without proper evaluation. |
| **('E', 'N')**    | - Evaluation and notification are tightly coupled (e.g., auto-notification for minor claims).<br>- A system error forces immediate notification post-evaluation. |

---

#### **3. SQL Verification Queries**

##### **A. Identify Claims with Unusual ('R', 'P') Timing**
```sql
SELECT
    c.claim_id,
    c.claim_type,
    a.name AS adjuster_name,
    EXTRACT(EPOCH FROM (ce2.timestamp - ce1.timestamp)) AS time_diff_seconds,
    CASE
        WHEN EXTRACT(EPOCH FROM (ce2.timestamp - ce1.timestamp)) < 21600 THEN 'Too Fast'
        WHEN EXTRACT(EPOCH FROM (ce2.timestamp - ce1.timestamp)) > 302400 THEN 'Too Slow'
        ELSE 'Normal'
    END AS timing_status
FROM
    claim_events ce1
JOIN
    claim_events ce2 ON ce1.claim_id = ce2.claim_id
JOIN
    claims c ON ce1.claim_id = c.claim_id
JOIN
    adjusters a ON ce2.resource = a.adjuster_id
WHERE
    ce1.activity = 'R' AND ce2.activity = 'P'
ORDER BY
    time_diff_seconds;
```

##### **B. Find Claims Where ('P', 'N') Delay Exceeds 14 Days (2 STDEV)**
```sql
SELECT
    c.claim_id,
    c.claim_type,
    a.name AS adjuster_name,
    EXTRACT(EPOCH FROM (ce2.timestamp - ce1.timestamp)) AS time_diff_seconds,
    CASE
        WHEN EXTRACT(EPOCH FROM (ce2.timestamp - ce1.timestamp)) > 604800 + 345600 THEN 'Extreme Delay'
        WHEN EXTRACT(EPOCH FROM (ce2.timestamp - ce1.timestamp)) < 604800 - 345600 THEN 'Unusually Fast'
        ELSE 'Normal'
    END AS timing_status
FROM
    claim_events ce1
JOIN
    claim_events ce2 ON ce1.claim_id = ce2.claim_id
JOIN
    claims c ON ce1.claim_id = c.claim_id
JOIN
    adjusters a ON ce2.resource = a.adjuster_id
WHERE
    ce1.activity = 'P' AND ce2.activity = 'N'
ORDER BY
    time_diff_seconds DESC;
```

##### **C. Detect Claims Closed Immediately After Assignment (Skipping 'E' or 'P')**
```sql
SELECT
    c.claim_id,
    c.claim_type,
    a.name AS adjuster_name,
    EXTRACT(EPOCH FROM (ce2.timestamp - ce1.timestamp)) AS time_diff_seconds
FROM
    claim_events ce1
JOIN
    claim_events ce2 ON ce1.claim_id = ce2.claim_id
JOIN
    claims c ON ce1.claim_id = c.claim_id
JOIN
    adjusters a ON ce2.resource = a.adjuster_id
WHERE
    ce1.activity = 'A' AND ce2.activity = 'C'
    AND NOT EXISTS (
        SELECT 1 FROM claim_events ce3
        WHERE ce3.claim_id = ce1.claim_id
        AND ce3.activity IN ('E', 'P')
        AND ce3.timestamp BETWEEN ce1.timestamp AND ce2.timestamp
    )
ORDER BY
    time_diff_seconds;
```

##### **D. Check for Immediate ('E', 'N') Transitions (Possible Bypass of 'P')**
```sql
SELECT
    c.claim_id,
    c.claim_type,
    a.name AS adjuster_name,
    EXTRACT(EPOCH FROM (ce2.timestamp - ce1.timestamp)) AS time_diff_seconds
FROM
    claim_events ce1
JOIN
    claim_events ce2 ON ce1.claim_id = ce2.claim_id
JOIN
    claims c ON ce1.claim_id = c.claim_id
JOIN
    adjusters a ON ce2.resource = a.adjuster_id
WHERE
    ce1.activity = 'E' AND ce2.activity = 'N'
    AND NOT EXISTS (
        SELECT 1 FROM claim_events ce3
        WHERE ce3.claim_id = ce1.claim_id
        AND ce3.activity = 'P'
        AND ce3.timestamp BETWEEN ce1.timestamp AND ce2.timestamp
    )
ORDER BY
    time_diff_seconds;
```

##### **E. Correlate Anomalies with Adjuster Specialization & Region**
```sql
SELECT
    a.specialization,
    a.region,
    COUNT(*) AS anomaly_count,
    AVG(EXTRACT(EPOCH FROM (ce2.timestamp - ce1.timestamp))) AS avg_time_diff
FROM
    claim_events ce1
JOIN
    claim_events ce2 ON ce1.claim_id = ce2.claim_id
JOIN
    adjusters a ON ce2.resource = a.adjuster_id
WHERE
    -- Filter for ('R', 'P') anomalies (e.g., < 21600s or > 302400s)
    (ce1.activity = 'R' AND ce2.activity = 'P'
     AND EXTRACT(EPOCH FROM (ce2.timestamp - ce1.timestamp)) < 21600)
    OR
    -- Filter for ('P', 'N') anomalies (e.g., > 604800s + 2*STDEV)
    (ce1.activity = 'P' AND ce2.activity = 'N'
     AND EXTRACT(EPOCH FROM (ce2.timestamp - ce1.timestamp)) > 604800 + 345600)
GROUP BY
    a.specialization, a.region
ORDER BY
    anomaly_count DESC;
```

---
### **Key Insights from Queries**
- **('R', 'P') anomalies** may reveal claims where evaluation is skipped, suggesting policy violations or automation issues.
- **('P', 'N') delays** could highlight adjusters or regions with notification bottlenecks.
- **Premature closures ('A', 'C')** indicate potential fraud or process shortcuts.
- **Immediate ('E', 'N') transitions** suggest auto-notification without approval, which may violate compliance rules.

These queries help pinpoint **who, what, and where** anomalies occur, enabling targeted process improvements.