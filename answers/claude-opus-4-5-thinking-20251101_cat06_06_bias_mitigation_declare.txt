# Updated DECLARE Model with Bias-Mitigating Constraints

## Updated Model

```python
declare_model = {
    "existence": {
        "StartApplication": {"support": 1.0, "confidence": 1.0},
        "FinalDecision": {"support": 1.0, "confidence": 1.0},
        # NEW: Ensure bias mitigation check is present in every process instance
        "BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}
    },
    "absence": {},
    "exactly_one": {},
    "init": {
        "StartApplication": {"support": 1.0, "confidence": 1.0}
    },
    "responded_existence": {
        # NEW: If sensitive attributes are checked, a bias mitigation check must exist
        "CheckApplicantRace": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}},
        "CheckApplicantGender": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}},
        "CheckApplicantAge": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}}
    },
    "coexistence": {
        "StartApplication": {"FinalDecision": {"support": 1.0, "confidence": 1.0}},
        # NEW: Decisions on minority applicants must coexist with manual review
        "Approve_Minority": {"ManualReview": {"support": 1.0, "confidence": 1.0}},
        "Reject_Minority": {"ManualReview": {"support": 1.0, "confidence": 1.0}},
        # NEW: Decisions on elderly applicants must coexist with manual review
        "Approve_ElderlyApplicant": {"ManualReview": {"support": 1.0, "confidence": 1.0}},
        "Reject_ElderlyApplicant": {"ManualReview": {"support": 1.0, "confidence": 1.0}}
    },
    "response": {
        "StartApplication": {"RequestAdditionalInfo": {"support": 1.0, "confidence": 1.0}},
        # NEW: After checking sensitive attributes, bias mitigation must eventually occur
        "CheckApplicantRace": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}},
        "CheckApplicantGender": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}},
        "CheckApplicantAge": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}}
    },
    "precedence": {
        # NEW: Any final decision must be preceded by a bias mitigation check
        "FinalDecision": {"BiasMitigationCheck": {"support": 1.0, "confidence": 1.0}},
        # NEW: Rejection must be preceded by manual review
        "Reject": {"ManualReview": {"support": 1.0, "confidence": 1.0}}
    },
    "succession": {
        "RequestAdditionalInfo": {"FinalDecision": {"support": 1.0, "confidence": 1.0}}
    },
    "altresponse": {},
    "altprecedence": {},
    "altsuccession": {},
    "chainresponse": {},
    "chainprecedence": {},
    "chainsuccession": {},
    "noncoexistence": {},
    "nonsuccession": {
        # NEW: Sensitive attribute checks cannot be directly followed by rejection
        "CheckApplicantRace": {"Reject": {"support": 1.0, "confidence": 1.0}},
        "CheckApplicantGender": {"Reject": {"support": 1.0, "confidence": 1.0}},
        "CheckApplicantAge": {"Reject": {"support": 1.0, "confidence": 1.0}}
    },
    "nonchainsuccession": {
        # NEW: Prevent immediate succession from sensitive attribute checks to any decision
        "CheckApplicantRace": {
            "Approve": {"support": 1.0, "confidence": 1.0},
            "Reject": {"support": 1.0, "confidence": 1.0}
        },
        "CheckApplicantGender": {
            "Approve": {"support": 1.0, "confidence": 1.0},
            "Reject": {"support": 1.0, "confidence": 1.0}
        },
        "CheckApplicantAge": {
            "Approve": {"support": 1.0, "confidence": 1.0},
            "Reject": {"support": 1.0, "confidence": 1.0}
        }
    }
}
```

---

## Rationale for Added Constraints

### 1. **Existence: `BiasMitigationCheck`**
| Constraint Type | Activity | Purpose |
|----------------|----------|---------|
| `existence` | `BiasMitigationCheck` | Ensures that every loan application process instance includes a dedicated bias mitigation check, making fairness verification mandatory. |

---

### 2. **Responded Existence: Sensitive Attribute Checks  `BiasMitigationCheck`**
| Constraint Type | From Activity | To Activity | Purpose |
|----------------|--------------|-------------|---------|
| `responded_existence` | `CheckApplicantRace` | `BiasMitigationCheck` | If race is checked, bias mitigation must occur somewhere in the trace |
| `responded_existence` | `CheckApplicantGender` | `BiasMitigationCheck` | If gender is checked, bias mitigation must occur somewhere in the trace |
| `responded_existence` | `CheckApplicantAge` | `BiasMitigationCheck` | If age is checked, bias mitigation must occur somewhere in the trace |

**Rationale:** Whenever sensitive demographic information is accessed, there must be a corresponding fairness check within the process to ensure decisions are not unduly influenced.

---

### 3. **Coexistence: Protected Group Decisions  `ManualReview`**
| Constraint Type | Decision Activity | Coexisting Activity | Purpose |
|----------------|-------------------|---------------------|---------|
| `coexistence` | `Approve_Minority` | `ManualReview` | Manual oversight for approvals involving minority applicants |
| `coexistence` | `Reject_Minority` | `ManualReview` | Manual oversight for rejections involving minority applicants |
| `coexistence` | `Approve_ElderlyApplicant` | `ManualReview` | Manual oversight for approvals involving elderly applicants |
| `coexistence` | `Reject_ElderlyApplicant` | `ManualReview` | Manual oversight for rejections involving elderly applicants |

**Rationale:** Decisions affecting applicants from protected demographic groups must always be accompanied by human review, ensuring accountability and reducing algorithmic bias.

---

### 4. **Response: Sensitive Attribute Checks  `BiasMitigationCheck`**
| Constraint Type | From Activity | To Activity | Purpose |
|----------------|--------------|-------------|---------|
| `response` | `CheckApplicantRace` | `BiasMitigationCheck` | Bias check must eventually follow race check |
| `response` | `CheckApplicantGender` | `BiasMitigationCheck` | Bias check must eventually follow gender check |
| `response` | `CheckApplicantAge` | `BiasMitigationCheck` | Bias check must eventually follow age check |

**Rationale:** Ensures that the bias mitigation check occurs **after** accessing sensitive information, allowing the check to evaluate whether the attribute influenced subsequent activities.

---

### 5. **Precedence: Decisions Must Be Preceded by Fairness Checks**
| Constraint Type | Decision Activity | Preceding Activity | Purpose |
|----------------|-------------------|-------------------|---------|
| `precedence` | `FinalDecision` | `BiasMitigationCheck` | No final decision without prior bias review |
| `precedence` | `Reject` | `ManualReview` | Rejections require prior manual review |

**Rationale:** Critical decision points must be gated by fairness verification steps, preventing hasty or biased outcomes.

---

### 6. **Non-Succession: Prevent Sensitive Checks  Reject Pattern**
| Constraint Type | From Activity | To Activity | Purpose |
|----------------|--------------|-------------|---------|
| `nonsuccession` | `CheckApplicantRace` | `Reject` | Race check can never be followed by rejection |
| `nonsuccession` | `CheckApplicantGender` | `Reject` | Gender check can never be followed by rejection |
| `nonsuccession` | `CheckApplicantAge` | `Reject` | Age check can never be followed by rejection |

**Rationale:** This strong constraint prevents any scenario where viewing a sensitive attribute leads to rejection, eliminating the possibility of discriminatory rejection patterns in the trace.

---

### 7. **Non-Chain Succession: Prevent Immediate Decisions After Sensitive Checks**
| Constraint Type | From Activity | To Activity | Purpose |
|----------------|--------------|-------------|---------|
| `nonchainsuccession` | `CheckApplicantRace` | `Approve` / `Reject` | Decisions cannot immediately follow race check |
| `nonchainsuccession` | `CheckApplicantGender` | `Approve` / `Reject` | Decisions cannot immediately follow gender check |
| `nonchainsuccession` | `CheckApplicantAge` | `Approve` / `Reject` | Decisions cannot immediately follow age check |

**Rationale:** Even if decisions eventually occur after sensitive attribute checks, they cannot occur **immediately** afterwards. This forces intervening activities (like `BiasMitigationCheck` or `ManualReview`) between accessing sensitive data and making decisions.

---

## Summary of Bias Mitigation Strategy

```

                     BIAS MITIGATION CONSTRAINT LAYERS                   

                                                                         
  Layer 1: EXISTENCE GUARANTEES                                          
                                            
  • BiasMitigationCheck must exist in every trace                        
                                                                         
  Layer 2: TEMPORAL ORDERING                                             
                                             
  • Sensitive attribute checks  BiasMitigationCheck (response)          
  • BiasMitigationCheck  FinalDecision (precedence)                     
  • ManualReview  Reject (precedence)                                   
                                                                         
  Layer 3: COEXISTENCE REQUIREMENTS                                      
                                        
  • Protected group decisions  ManualReview                             
                                                                         
  Layer 4: PROHIBITED PATTERNS                                           
                                             
  • No direct path from sensitive check  decision (nonchainsuccession)  
  • No path from sensitive check  rejection (nonsuccession)             
                                                                         

```

These layered constraints work together to ensure that:
1. **No decision is made in a vacuum** — bias checks are mandatory
2. **Sensitive data access is monitored** — fairness checks follow attribute checks
3. **Protected groups receive extra scrutiny** — manual review is guaranteed
4. **Discrimination patterns are blocked** — immediate succession from sensitive data to decisions is prohibited